!function(){return function e(t,i,n){function o(a,s){if(!i[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(r)return r(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var d=i[a]={exports:{}};t[a][0].call(d.exports,function(e){return o(t[a][1][e]||e)},d,d.exports,e,t,i,n)}return i[a].exports}for(var r="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}}()({1:[function(e,t,i){"use strict";e("./")},{"./":2}],2:[function(e,t,i){"use strict";e("./src/controls"),e("./src/loaders"),e("./src/misc"),e("./src/pathfinding"),e("./src/primitives")},{"./src/controls":13,"./src/loaders":23,"./src/misc":28,"./src/pathfinding":31,"./src/primitives":39}],3:[function(e,t,i){"use strict";t.exports=THREE.ColladaLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"anonymous",load:function(e,t,i,n){var o=this,r=void 0===o.path?THREE.LoaderUtils.extractUrlBase(e):o.path,a=new THREE.FileLoader(o.manager);a.setPath(o.path),a.load(e,function(e){t(o.parse(e,r))},i,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){function i(e,t){for(var i=[],n=e.childNodes,o=0,r=n.length;o<r;o++){var a=n[o];a.nodeName===t&&i.push(a)}return i}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),n=0,o=t.length;n<o;n++)i[n]=t[n];return i}function o(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),n=0,o=t.length;n<o;n++)i[n]=parseFloat(t[n]);return i}function r(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),n=0,o=t.length;n<o;n++)i[n]=parseInt(t[n]);return i}function a(e){return e.substring(1)}function s(e){return 0===Object.keys(e).length}function c(e,t,n,o){var r=i(e,t)[0];if(void 0!==r)for(var a=i(r,n),s=0;s<a.length;s++)o(a[s])}function l(e,t){for(var i in e){e[i].build=t(e[i])}}function d(e,t){return void 0!==e.build?e.build:(e.build=t(e),e.build)}function h(e){for(var t={inputs:{}},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"input":var r=a(o.getAttribute("source")),s=o.getAttribute("semantic");t.inputs[s]=r}}return t}function u(e){var t={},i=e.getAttribute("target").split("/"),n=i.shift(),o=i.shift(),r=-1!==o.indexOf("("),s=-1!==o.indexOf(".");if(s)o=(i=o.split(".")).shift(),t.member=i.shift();else if(r){var c=o.split("(");o=c.shift();for(var l=0;l<c.length;l++)c[l]=parseInt(c[l].replace(/\)/,""));t.indices=c}return t.id=n,t.sid=o,t.arraySyntax=r,t.memberSyntax=s,t.sampler=a(e.getAttribute("source")),t}function p(e){var t=[],i=e.channels,n=e.samplers,o=e.sources;for(var r in i)if(i.hasOwnProperty(r)){var a=i[r],s=n[a.sampler],c=s.inputs.INPUT,l=s.inputs.OUTPUT;E(m(a,o[c],o[l]),t)}return t}function f(e){return d(ze.animations[e],p)}function m(e,t,i){var n,o,r,a,s,c,l=ze.nodes[e.id],d=De(l.id),h=l.transforms[e.sid],u=l.matrix.clone().transpose(),p={};switch(h){case"matrix":for(r=0,a=t.array.length;r<a;r++)if(n=t.array[r],o=r*i.stride,void 0===p[n]&&(p[n]={}),!0===e.arraySyntax){var f=i.array[o],m=e.indices[0]+4*e.indices[1];p[n][m]=f}else for(s=0,c=i.stride;s<c;s++)p[n][s]=i.array[o+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var v=function(e,t){var i=[];for(var n in e)i.push({time:parseFloat(n),value:e[n]});i.sort(function(e,t){return e.time-t.time});for(var o=0;o<16;o++)b(i,o,t.elements[o]);return i}(p,u);return{name:d.uuid,keyframes:v}}var v=new THREE.Vector3,y=new THREE.Vector3,g=new THREE.Quaternion;function E(e,t){for(var i=e.keyframes,n=e.name,o=[],r=[],a=[],s=[],c=0,l=i.length;c<l;c++){var d=i[c],h=d.time,u=d.value;ke.fromArray(u).transpose(),ke.decompose(v,g,y),o.push(h),r.push(v.x,v.y,v.z),a.push(g.x,g.y,g.z,g.w),s.push(y.x,y.y,y.z)}return r.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".position",o,r)),a.length>0&&t.push(new THREE.QuaternionKeyframeTrack(n+".quaternion",o,a)),s.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".scale",o,s)),t}function b(e,t,i){var n,o,r,a=!0;for(o=0,r=e.length;o<r;o++)void 0===(n=e[o]).value[t]?n.value[t]=null:a=!1;if(!0===a)for(o=0,r=e.length;o<r;o++)(n=e[o]).value[t]=i;else!function(e,t){for(var i,n,o=0,r=e.length;o<r;o++){var a=e[o];if(null===a.value[t]){if(i=k(e,o,t),n=w(e,o,t),null===i){a.value[t]=n.value[t];continue}if(null===n){a.value[t]=i.value[t];continue}T(a,i,n,t)}}}(e,t)}function k(e,t,i){for(;t>=0;){var n=e[t];if(null!==n.value[i])return n;t--}return null}function w(e,t,i){for(;t<e.length;){var n=e[t];if(null!==n.value[i])return n;t++}return null}function T(e,t,i,n){i.time-t.time!=0?e.value[n]=(e.time-t.time)*(i.value[n]-t.value[n])/(i.time-t.time)+t.value[n]:e.value[n]=t.value[n]}function x(e){for(var t=[],i=e.name,n=e.end-e.start||-1,o=e.animations,r=0,a=o.length;r<a;r++)for(var s=f(o[r]),c=0,l=s.length;c<l;c++)t.push(s[c]);return new THREE.AnimationClip(i,n,t)}function A(e){return d(ze.clips[e],x)}function R(e){for(var t={sources:{}},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=o(r.textContent);break;case"source":var a=r.getAttribute("id");t.sources[a]=ie(r);break;case"joints":t.joints=N(r);break;case"vertex_weights":t.vertexWeights=M(r)}}return t}function N(e){for(var t={inputs:{}},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"input":var r=o.getAttribute("semantic"),s=a(o.getAttribute("source"));t.inputs[r]=s}}return t}function M(e){for(var t={inputs:{}},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"input":var s=o.getAttribute("semantic"),c=a(o.getAttribute("source")),l=parseInt(o.getAttribute("offset"));t.inputs[s]={id:c,offset:l};break;case"vcount":t.vcount=r(o.textContent);break;case"v":t.v=r(o.textContent)}}return t}function C(e){var t={id:e.id},i=ze.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,i,n,o={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},r=e.sources,a=e.vertexWeights,s=a.vcount,c=a.v,l=a.inputs.JOINT.offset,d=a.inputs.WEIGHT.offset,h=e.sources[e.joints.inputs.JOINT],u=e.sources[e.joints.inputs.INV_BIND_MATRIX],p=r[a.inputs.WEIGHT.id].array,f=0;for(t=0,n=s.length;t<n;t++){var m=s[t],v=[];for(i=0;i<m;i++){var y=c[f+l],g=c[f+d],E=p[g];v.push({index:y,weight:E}),f+=2}for(v.sort(T),i=0;i<4;i++){var b=v[i];void 0!==b?(o.indices.array.push(b.index),o.weights.array.push(b.weight)):(o.indices.array.push(0),o.weights.array.push(0))}}e.bindShapeMatrix?o.bindMatrix=(new THREE.Matrix4).fromArray(e.bindShapeMatrix).transpose():o.bindMatrix=(new THREE.Matrix4).identity();for(t=0,n=h.array.length;t<n;t++){var k=h.array[t],w=(new THREE.Matrix4).fromArray(u.array,t*u.stride).transpose();o.joints.push({name:k,boneInverse:w})}return o;function T(e,t){return t.weight-e.weight}}(e.skin),i.sources.skinIndices=t.skin.indices,i.sources.skinWeights=t.skin.weights),t}function O(e){return void 0!==e.build?e.build:e.init_from}function L(e){var t=ze.images[e];return void 0!==t?d(t,O):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function D(e){for(var t={surfaces:{},samplers:{}},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"newparam":H(o,t);break;case"technique":t.technique=S(o);break;case"extra":t.extra=K(o)}}return t}function H(e,t){for(var i=e.getAttribute("sid"),n=0,o=e.childNodes.length;n<o;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"surface":t.surfaces[i]=I(r);break;case"sampler2D":t.samplers[i]=P(r)}}}function I(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"init_from":t.init_from=o.textContent}}return t}function P(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"source":t.source=o.textContent}}return t}function S(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=o.nodeName,t.parameters=_(o)}}return t}function _(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[o.nodeName]=F(o);break;case"transparent":t[o.nodeName]={opaque:o.getAttribute("opaque"),data:F(o)}}}return t}function F(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"color":t[r.nodeName]=o(r.textContent);break;case"float":t[r.nodeName]=parseFloat(r.textContent);break;case"texture":t[r.nodeName]={id:r.getAttribute("texture"),extra:j(r)}}}return t}function j(e){for(var t={technique:{}},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"extra":V(o,t)}}return t}function V(e,t){for(var i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"technique":B(o,t)}}}function B(e,t){for(var i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[o.nodeName]=parseFloat(o.textContent);break;case"wrapU":case"wrapV":"TRUE"===o.textContent.toUpperCase()?t.technique[o.nodeName]=1:"FALSE"===o.textContent.toUpperCase()?t.technique[o.nodeName]=0:t.technique[o.nodeName]=parseInt(o.textContent)}}}function K(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"technique":t.technique=z(o)}}return t}function z(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"double_sided":t[o.nodeName]=parseInt(o.textContent)}}return t}function U(e){return e}function G(e){var t,i,n=(t=e.url,d(ze.effects[t],U)),o=n.profile.technique,r=n.profile.extra;switch(o.type){case"phong":case"blinn":i=new THREE.MeshPhongMaterial;break;case"lambert":i=new THREE.MeshLambertMaterial;break;default:i=new THREE.MeshBasicMaterial}function a(e){var t=n.profile.samplers[e.id],i=null;void 0!==t?i=L(n.profile.surfaces[t.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),i=L(e.id));if(null!==i){var o=function(e){var t,i=e.slice(2+(e.lastIndexOf(".")-1>>>0));switch(i=i.toLowerCase()){case"tga":t=_e;break;default:t=je}return t}(i);if(void 0!==o){var r=o.load(i),a=e.extra;if(void 0!==a&&void 0!==a.technique&&!1===s(a.technique)){var c=a.technique;r.wrapS=c.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,r.wrapT=c.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,r.offset.set(c.offsetU||0,c.offsetV||0),r.repeat.set(c.repeatU||1,c.repeatV||1)}else r.wrapS=THREE.RepeatWrapping,r.wrapT=THREE.RepeatWrapping;return r}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",i),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}i.name=e.name;var c=o.parameters;for(var l in c){var h=c[l];switch(l){case"diffuse":h.color&&i.color.fromArray(h.color),h.texture&&(i.map=a(h.texture));break;case"specular":h.color&&i.specular&&i.specular.fromArray(h.color),h.texture&&(i.specularMap=a(h.texture));break;case"bump":h.texture&&(i.normalMap=a(h.texture));break;case"ambient":h.texture&&(i.lightMap=a(h.texture));break;case"shininess":h.float&&i.shininess&&(i.shininess=h.float);break;case"emission":h.color&&i.emissive&&i.emissive.fromArray(h.color),h.texture&&(i.emissiveMap=a(h.texture))}}var u=c.transparent,p=c.transparency;if(void 0===p&&u&&(p={float:1}),void 0===u&&p&&(u={opaque:"A_ONE",data:{color:[1,1,1,1]}}),u&&p)if(u.data.texture)i.transparent=!0;else{var f=u.data.color;switch(u.opaque){case"A_ONE":i.opacity=f[3]*p.float;break;case"RGB_ZERO":i.opacity=1-f[0]*p.float;break;case"A_ZERO":i.opacity=1-f[3]*p.float;break;case"RGB_ONE":i.opacity=f[0]*p.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',u.opaque)}i.opacity<1&&(i.transparent=!0)}return void 0!==r&&void 0!==r.technique&&1===r.technique.double_sided&&(i.side=THREE.DoubleSide),i}function q(e){return d(ze.materials[e],G)}function X(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"technique_common":return W(i)}}return{}}function W(e){for(var t={},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];switch(n.nodeName){case"perspective":case"orthographic":t.technique=n.nodeName,t.parameters=Z(n)}}return t}function Z(e){for(var t={},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[n.nodeName]=parseFloat(n.textContent)}}return t}function J(e){var t;switch(e.optics.technique){case"perspective":t=new THREE.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var i=e.optics.parameters.ymag,n=e.optics.parameters.xmag,o=e.optics.parameters.aspect_ratio;n=void 0===n?i*o:n,i=void 0===i?n/o:i,n*=.5,i*=.5,t=new THREE.OrthographicCamera(-n,n,i,-i,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new THREE.PerspectiveCamera}return t.name=e.name,t}function Y(e){var t=ze.cameras[e];return void 0!==t?d(t,J):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function Q(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=o.nodeName,t.parameters=$(o)}}return t}function $(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"color":var a=o(r.textContent);t.color=(new THREE.Color).fromArray(a);break;case"falloff_angle":t.falloffAngle=parseFloat(r.textContent);break;case"quadratic_attenuation":var s=parseFloat(r.textContent);t.distance=s?Math.sqrt(1/s):0}}return t}function ee(e){var t;switch(e.technique){case"directional":t=new THREE.DirectionalLight;break;case"point":t=new THREE.PointLight;break;case"spot":t=new THREE.SpotLight;break;case"ambient":t=new THREE.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function te(e){var t=ze.lights[e];return void 0!==t?d(t,ee):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function ie(e){for(var t={array:[],stride:3},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"float_array":t.array=o(a.textContent);break;case"Name_array":t.array=n(a.textContent);break;case"technique_common":var s=i(a,"accessor")[0];void 0!==s&&(t.stride=parseInt(s.getAttribute("stride")))}}return t}function ne(e){for(var t={},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];1===n.nodeType&&(t[n.getAttribute("semantic")]=a(n.getAttribute("source")))}return t}function oe(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"input":var s=a(o.getAttribute("source")),c=o.getAttribute("semantic"),l=parseInt(o.getAttribute("offset")),d=parseInt(o.getAttribute("set")),h=d>0?c+d:c;t.inputs[h]={id:s,offset:l},t.stride=Math.max(t.stride,l+1),"TEXCOORD"===c&&(t.hasUV=!0);break;case"vcount":t.vcount=r(o.textContent);break;case"p":t.p=r(o.textContent)}}return t}function re(e){for(var t=0,i=0,n=e.length;i<n;i++){!0===e[i].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function ae(e){var t={},i=e.sources,n=e.vertices,o=e.primitives;if(0===o.length)return{};var r=function(e){for(var t={},i=0;i<e.length;i++){var n=e[i];void 0===t[n.type]&&(t[n.type]=[]),t[n.type].push(n)}return t}(o);for(var a in r){var s=r[a];re(s),t[a]=se(s,i,n)}return t}function se(e,t,i){for(var n={},o={array:[],stride:0},r={array:[],stride:0},a={array:[],stride:0},s={array:[],stride:0},c={array:[],stride:0},l=[],d=4,h=[],u=4,p=new THREE.BufferGeometry,f=[],m=0,v=0;v<e.length;v++){var y=e[v],g=y.inputs,E=0;switch(y.type){case"lines":case"linestrips":E=2*y.count;break;case"triangles":E=3*y.count;break;case"polylist":for(var b=0;b<y.count;b++){var k=y.vcount[b];switch(k){case 3:E+=3;break;case 4:E+=6;break;default:E+=3*(k-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",y.type)}for(var w in p.addGroup(m,E,v),m+=E,y.material&&f.push(y.material),g){var T=g[w];switch(w){case"VERTEX":for(var x in i){var A=i[x];switch(x){case"POSITION":var R=o.array.length;if(ce(y,t[A],T.offset,o.array),o.stride=t[A].stride,t.skinWeights&&t.skinIndices&&(ce(y,t.skinIndices,T.offset,l),ce(y,t.skinWeights,T.offset,h)),!1===y.hasUV&&!0===e.uvsNeedsFix){E=(o.array.length-R)/o.stride;for(var N=0;N<E;N++)a.array.push(0,0)}break;case"NORMAL":ce(y,t[A],T.offset,r.array),r.stride=t[A].stride;break;case"COLOR":ce(y,t[A],T.offset,c.array),c.stride=t[A].stride;break;case"TEXCOORD":ce(y,t[A],T.offset,a.array),a.stride=t[A].stride;break;case"TEXCOORD1":ce(y,t[A],T.offset,s.array),a.stride=t[A].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',x)}}break;case"NORMAL":ce(y,t[T.id],T.offset,r.array),r.stride=t[T.id].stride;break;case"COLOR":ce(y,t[T.id],T.offset,c.array),c.stride=t[T.id].stride;break;case"TEXCOORD":ce(y,t[T.id],T.offset,a.array),a.stride=t[T.id].stride;break;case"TEXCOORD1":ce(y,t[T.id],T.offset,s.array),s.stride=t[T.id].stride}}}return o.array.length>0&&p.addAttribute("position",new THREE.Float32BufferAttribute(o.array,o.stride)),r.array.length>0&&p.addAttribute("normal",new THREE.Float32BufferAttribute(r.array,r.stride)),c.array.length>0&&p.addAttribute("color",new THREE.Float32BufferAttribute(c.array,c.stride)),a.array.length>0&&p.addAttribute("uv",new THREE.Float32BufferAttribute(a.array,a.stride)),s.array.length>0&&p.addAttribute("uv2",new THREE.Float32BufferAttribute(s.array,s.stride)),l.length>0&&p.addAttribute("skinIndex",new THREE.Float32BufferAttribute(l,d)),h.length>0&&p.addAttribute("skinWeight",new THREE.Float32BufferAttribute(h,u)),n.data=p,n.type=e[0].type,n.materialKeys=f,n}function ce(e,t,i,n){var o=e.p,r=e.stride,a=e.vcount;function s(e){for(var t=o[e+i]*l,r=t+l;t<r;t++)n.push(c[t])}var c=t.array,l=t.stride;if(void 0!==e.vcount)for(var d=0,h=0,u=a.length;h<u;h++){var p=a[h];if(4===p){var f=d+1*r,m=d+2*r,v=d+3*r;s(d+0*r),s(f),s(v),s(f),s(m),s(v)}else if(3===p){f=d+1*r,m=d+2*r;s(d+0*r),s(f),s(m)}else if(p>4)for(var y=1,g=p-2;y<=g;y++){f=d+r*y,m=d+r*(y+1);s(d+0*r),s(f),s(m)}d+=r*p}else for(h=0,u=o.length;h<u;h+=r)s(h)}function le(e){return d(ze.geometries[e],ae)}function de(e){return void 0!==e.build?e.build:e}function he(e,t){for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"joint":t.joints[n.getAttribute("sid")]=ue(n);break;case"link":t.links.push(fe(n))}}}function ue(e){for(var t,i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":t=pe(n)}}return t}function pe(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"axis":var r=o(n.textContent);t.axis.fromArray(r);break;case"limits":var a=n.getElementsByTagName("max")[0],s=n.getElementsByTagName("min")[0];t.limits.max=parseFloat(a.textContent),t.limits.min=parseFloat(s.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function fe(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":t.attachments.push(me(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ve(n))}}return t}function me(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"link":t.links.push(fe(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ve(n))}}return t}function ve(e){var t={type:e.nodeName},i=o(e.textContent);switch(t.type){case"matrix":t.obj=new THREE.Matrix4,t.obj.fromArray(i).transpose();break;case"translate":t.obj=new THREE.Vector3,t.obj.fromArray(i);break;case"rotate":t.obj=new THREE.Vector3,t.obj.fromArray(i),t.angle=THREE.MathUtils.degToRad(i[3])}return t}function ye(e,t){for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"technique_common":ge(n,t)}}}function ge(e,t){for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"inertia":t.inertia=o(n.textContent);break;case"mass":t.mass=o(n.textContent)[0]}}}function Ee(e){for(var t={target:e.getAttribute("target").split("/").pop()},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"axis":var o=n.getElementsByTagName("param")[0];t.axis=o.textContent;var r=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=r.substr(0,r.length-1)}}return t}function be(e){return void 0!==e.build?e.build:e}var ke=new THREE.Matrix4,we=new THREE.Vector3;function Te(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"node":t.nodes.push(n.getAttribute("id")),Te(n);break;case"instance_camera":t.instanceCameras.push(a(n.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(xe(n));break;case"instance_light":t.instanceLights.push(a(n.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(xe(n));break;case"instance_node":t.instanceNodes.push(a(n.getAttribute("url")));break;case"matrix":var r=o(n.textContent);t.matrix.multiply(ke.fromArray(r).transpose()),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":r=o(n.textContent);we.fromArray(r),t.matrix.multiply(ke.makeTranslation(we.x,we.y,we.z)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":r=o(n.textContent);var s=THREE.MathUtils.degToRad(r[3]);t.matrix.multiply(ke.makeRotationAxis(we.fromArray(r),s)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":r=o(n.textContent);t.matrix.scale(we.fromArray(r)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return Le(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):ze.nodes[t.id]=t,t}function xe(e){for(var t={id:a(e.getAttribute("url")),materials:{},skeletons:[]},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];switch(n.nodeName){case"bind_material":for(var o=n.getElementsByTagName("instance_material"),r=0;r<o.length;r++){var s=o[r],c=s.getAttribute("symbol"),l=s.getAttribute("target");t.materials[c]=a(l)}break;case"skeleton":t.skeletons.push(a(n.textContent))}}return t}function Ae(e,t){var i,n,o,r=[],a=[];for(i=0;i<e.length;i++){var s=e[i];if(Le(s))Re(De(s),t,r);else if(o=s,void 0!==ze.visualScenes[o])for(var c=ze.visualScenes[s].children,l=0;l<c.length;l++){var d=c[l];if("JOINT"===d.type)Re(De(d.id),t,r)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(i=0;i<t.length;i++)for(l=0;l<r.length;l++)if((n=r[l]).bone.name===t[i].name){a[i]=n,n.processed=!0;break}for(i=0;i<r.length;i++)!1===(n=r[i]).processed&&(a.push(n),n.processed=!0);var h=[],u=[];for(i=0;i<a.length;i++)n=a[i],h.push(n.bone),u.push(n.boneInverse);return new THREE.Skeleton(h,u)}function Re(e,t,i){e.traverse(function(e){if(!0===e.isBone){for(var n,o=0;o<t.length;o++){var r=t[o];if(r.name===e.name){n=r.boneInverse;break}}void 0===n&&(n=new THREE.Matrix4),i.push({bone:e,boneInverse:n,processed:!1})}})}function Ne(e){for(var t,i=[],n=e.matrix,o=e.nodes,r=e.type,a=e.instanceCameras,s=e.instanceControllers,c=e.instanceLights,l=e.instanceGeometries,h=e.instanceNodes,u=0,p=o.length;u<p;u++)i.push(De(o[u]));for(u=0,p=a.length;u<p;u++){var f=Y(a[u]);null!==f&&i.push(f.clone())}for(u=0,p=s.length;u<p;u++)for(var m=s[u],v=(t=m.id,d(ze.controllers[t],C)),y=Oe(le(v.id),m.materials),g=Ae(m.skeletons,v.skin.joints),E=0,b=y.length;E<b;E++){var k;(k=y[E]).isSkinnedMesh&&(k.bind(g,v.skin.bindMatrix),k.normalizeSkinWeights()),i.push(k)}for(u=0,p=c.length;u<p;u++){var w=te(c[u]);null!==w&&i.push(w.clone())}for(u=0,p=l.length;u<p;u++)for(E=0,b=(y=Oe(le((m=l[u]).id),m.materials)).length;E<b;E++)i.push(y[E]);for(u=0,p=h.length;u<p;u++)i.push(De(h[u]).clone());if(0===o.length&&1===i.length)k=i[0];else{k="JOINT"===r?new THREE.Bone:new THREE.Group;for(u=0;u<i.length;u++)k.add(i[u])}return""===k.name&&(k.name="JOINT"===r?e.sid:e.name),k.matrix.copy(n),k.matrix.decompose(k.position,k.quaternion,k.scale),k}var Me=new THREE.MeshBasicMaterial({color:16711935});function Ce(e,t){for(var i=[],n=0,o=e.length;n<o;n++){var r=t[e[n]];void 0===r?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[n]),i.push(Me)):i.push(q(r))}return i}function Oe(e,t){var i=[];for(var n in e){var o=e[n],r=Ce(o.materialKeys,t);0===r.length&&("lines"===n||"linestrips"===n?r.push(new THREE.LineBasicMaterial):r.push(new THREE.MeshPhongMaterial));var a=void 0!==o.data.attributes.skinIndex;if(a)for(var s=0,c=r.length;s<c;s++)r[s].skinning=!0;var l,d=1===r.length?r[0]:r;switch(n){case"lines":l=new THREE.LineSegments(o.data,d);break;case"linestrips":l=new THREE.Line(o.data,d);break;case"triangles":case"polylist":l=a?new THREE.SkinnedMesh(o.data,d):new THREE.Mesh(o.data,d)}i.push(l)}return i}function Le(e){return void 0!==ze.nodes[e]}function De(e){return d(ze.nodes[e],Ne)}function He(e){var t=new THREE.Group;t.name=e.name;for(var i=e.children,n=0;n<i.length;n++){var o=i[n];t.add(De(o.id))}return t}function Ie(e){return d(ze.visualScenes[e],He)}if(0===e.length)return{scene:new THREE.Scene};var Pe=i((new DOMParser).parseFromString(e,"application/xml"),"COLLADA")[0],Se=Pe.getAttribute("version");console.log("THREE.ColladaLoader: File version",Se);var _e,Fe=function(e){return{unit:function(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}(i(e,"unit")[0]),upAxis:function(e){return void 0!==e?e.textContent:"Y_UP"}(i(e,"up_axis")[0])}}(i(Pe,"asset")[0]),je=new THREE.TextureLoader(this.manager);je.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),THREE.TGALoader&&(_e=new THREE.TGALoader(this.manager)).setPath(this.resourcePath||t);var Ve=[],Be={},Ke=0,ze={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};c(Pe,"library_animations","animation",function(e){for(var t={sources:{},samplers:{},channels:{}},i=0,n=e.childNodes.length;i<n;i++){var o,r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"source":o=r.getAttribute("id"),t.sources[o]=ie(r);break;case"sampler":o=r.getAttribute("id"),t.samplers[o]=h(r);break;case"channel":o=r.getAttribute("target"),t.channels[o]=u(r);break;default:console.log(r)}}ze.animations[e.getAttribute("id")]=t}),c(Pe,"library_animation_clips","animation_clip",function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"instance_animation":t.animations.push(a(o.getAttribute("url")))}}ze.clips[e.getAttribute("id")]=t}),c(Pe,"library_controllers","controller",function(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"skin":t.id=a(o.getAttribute("source")),t.skin=R(o);break;case"morph":t.id=a(o.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}ze.controllers[e.getAttribute("id")]=t}),c(Pe,"library_images","image",function(e){var t={init_from:i(e,"init_from")[0].textContent};ze.images[e.getAttribute("id")]=t}),c(Pe,"library_effects","effect",function(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"profile_COMMON":t.profile=D(o)}}ze.effects[e.getAttribute("id")]=t}),c(Pe,"library_materials","material",function(e){for(var t={name:e.getAttribute("name")},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"instance_effect":t.url=a(o.getAttribute("url"))}}ze.materials[e.getAttribute("id")]=t}),c(Pe,"library_cameras","camera",function(e){for(var t={name:e.getAttribute("name")},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"optics":t.optics=X(o)}}ze.cameras[e.getAttribute("id")]=t}),c(Pe,"library_lights","light",function(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"technique_common":t=Q(o)}}ze.lights[e.getAttribute("id")]=t}),c(Pe,"library_geometries","geometry",function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=i(e,"mesh")[0];if(void 0!==n){for(var o=0;o<n.childNodes.length;o++){var r=n.childNodes[o];if(1===r.nodeType){var a=r.getAttribute("id");switch(r.nodeName){case"source":t.sources[a]=ie(r);break;case"vertices":t.vertices=ne(r);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",r.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(oe(r));break;default:console.log(r)}}}ze.geometries[e.getAttribute("id")]=t}}),c(Pe,"library_nodes","node",Te),c(Pe,"library_visual_scenes","visual_scene",function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),i=0;i<t.length;i++){var n=t[i];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+Ke++)}}(e);for(var n=i(e,"node"),o=0;o<n.length;o++)t.children.push(Te(n[o]));ze.visualScenes[e.getAttribute("id")]=t}),c(Pe,"library_kinematics_models","kinematics_model",function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"technique_common":he(n,t)}}ze.kinematicsModels[e.getAttribute("id")]=t}),c(Pe,"library_physics_models","physics_model",function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"rigid_body":t.rigidBodies[n.getAttribute("name")]={},ye(n,t.rigidBodies[n.getAttribute("name")])}}ze.physicsModels[e.getAttribute("id")]=t}),c(Pe,"scene","instance_kinematics_scene",function(e){for(var t={bindJointAxis:[]},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"bind_joint_axis":t.bindJointAxis.push(Ee(n))}}ze.kinematicsScenes[a(e.getAttribute("url"))]=t}),l(ze.animations,p),l(ze.clips,x),l(ze.controllers,C),l(ze.images,O),l(ze.effects,U),l(ze.materials,G),l(ze.cameras,J),l(ze.lights,ee),l(ze.geometries,ae),l(ze.visualScenes,He),function(){var e=ze.clips;if(!0===s(e)){if(!1===s(ze.animations)){var t=[];for(var i in ze.animations)for(var n=f(i),o=0,r=n.length;o<r;o++)t.push(n[o]);Ve.push(new THREE.AnimationClip("default",-1,t))}}else for(var i in e)Ve.push(A(i))}(),function(){var e=Object.keys(ze.kinematicsModels)[0],t=Object.keys(ze.kinematicsScenes)[0],i=Object.keys(ze.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var n,r=(n=e,d(ze.kinematicsModels[n],de)),a=function(e){return d(ze.kinematicsScenes[e],be)}(t),s=Ie(i),c=a.bindJointAxis,l={},h=0,u=c.length;h<u;h++){var p=c[h],f=Pe.querySelector('[sid="'+p.target+'"]');if(f){var m=f.parentElement;y(p.jointIndex,m)}}var v=new THREE.Matrix4;Be={joints:r&&r.joints,getJointValue:function(e){var t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var i=l[e];if(i){var n=i.joint;if(t>n.limits.max||t<n.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var o=i.object,r=n.axis,a=i.transforms;ke.identity();for(var s=0;s<a.length;s++){var c=a[s];if(c.sid&&-1!==c.sid.indexOf(e))switch(n.type){case"revolute":ke.multiply(v.makeRotationAxis(r,THREE.MathUtils.degToRad(t)));break;case"prismatic":ke.multiply(v.makeTranslation(r.x*t,r.y*t,r.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+n.type)}else switch(c.type){case"matrix":ke.multiply(c.obj);break;case"translate":ke.multiply(v.makeTranslation(c.obj.x,c.obj.y,c.obj.z));break;case"scale":ke.scale(c.obj);break;case"rotate":ke.multiply(v.makeRotationAxis(c.obj,c.angle))}}o.matrix.copy(ke),o.matrix.decompose(o.position,o.quaternion,o.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function y(e,t){var i=t.getAttribute("name"),n=r.joints[e];s.traverse(function(r){r.name===i&&(l[e]={object:r,transforms:function(e){for(var t=[],i=Pe.querySelector('[id="'+e.id+'"]'),n=0;n<i.childNodes.length;n++){var r=i.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"matrix":var a=o(r.textContent),s=(new THREE.Matrix4).fromArray(a).transpose();t.push({sid:r.getAttribute("sid"),type:r.nodeName,obj:s});break;case"translate":case"scale":var a=o(r.textContent),c=(new THREE.Vector3).fromArray(a);t.push({sid:r.getAttribute("sid"),type:r.nodeName,obj:c});break;case"rotate":var a=o(r.textContent),c=(new THREE.Vector3).fromArray(a),l=THREE.MathUtils.degToRad(a[3]);t.push({sid:r.getAttribute("sid"),type:r.nodeName,obj:c,angle:l})}}return t}(t),joint:n,position:n.zeroPosition})})}}();var Ue=function(e){return Ie(a(i(e,"instance_visual_scene")[0].getAttribute("url")))}(i(Pe,"scene")[0]);return"Z_UP"===Fe.upAxis&&Ue.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),Ue.scale.multiplyScalar(Fe.unit),{animations:Ve,kinematics:Be,library:ze,scene:Ue}}}},{}],4:[function(e,t,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(e){return void 0===e?"undefined":n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":n(e)};t.exports=THREE.FBXLoader=function(){var e,t,i;function n(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager}function r(e){this.textureLoader=e}function a(){}function s(){}function c(){}function l(){}function d(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function h(){}function u(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function p(e){return e/46186158e3}n.prototype={constructor:n,crossOrigin:"anonymous",load:function(e,t,i,n){var o=this,r=THREE.LoaderUtils.extractUrlBase(e),a=new THREE.FileLoader(this.manager);a.setResponseType("arraybuffer"),a.load(e,function(i){try{var a=o.parse(i,r);t(a)}catch(t){setTimeout(function(){n&&n(t),o.manager.itemError(e)},0)}},i,n)},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(t,i){if(a="Kaydara FBX Binary  \0",(o=t).byteLength>=a.length&&a===x(o,0,a.length))e=(new l).parse(t);else{var n=x(t);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],i=0;function n(t){var n=e[t-1];return e=e.slice(i+t),i++,n}for(var o=0;o<t.length;++o){var r=n(1);if(r===t[o])return!1}return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(u(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+u(n));e=(new c).parse(n)}var o,a;return new r(new THREE.TextureLoader(this.manager).setPath(i).setCrossOrigin(this.crossOrigin)).parse(e)}},r.prototype={constructor:r,parse:function(){t=this.parseConnections();var e=this.parseImages(),n=this.parseTextures(e),o=this.parseMaterials(n),r=this.parseDeformers(),s=(new a).parse(r);return this.parseScene(r,s,o),i},parseConnections:function(){var t=new Map;"Connections"in e&&e.Connections.connections.forEach(function(e){var i=e[0],n=e[1],o=e[2];t.has(i)||t.set(i,{parents:[],children:[]});var r={ID:n,relationship:o};t.get(i).parents.push(r),t.has(n)||t.set(n,{parents:[],children:[]});var a={ID:i,relationship:o};t.get(n).children.push(a)});return t},parseImages:function(){var t={},i={};if("Video"in e.Objects){var n=e.Objects.Video;for(var o in n){var r=n[o];if(t[l=parseInt(o)]=r.RelativeFilename||r.Filename,"Content"in r){var a=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,s="string"==typeof r.Content&&""!==r.Content;if(a||s){var c=this.parseImage(n[o]);i[r.RelativeFilename||r.Filename]=c}}}}for(var l in t){var d=t[l];void 0!==i[d]?t[l]=i[d]:t[l]=t[l].split("\\").pop()}return t},parseImage:function(e){var t,i=e.Content,n=e.RelativeFilename||e.Filename,o=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(o){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":if("function"!=typeof THREE.TGALoader)return void console.warn("FBXLoader: THREE.TGALoader is required to load TGA textures");null===THREE.Loader.Handlers.get(".tga")&&THREE.Loader.Handlers.add(/\.tga$/i,new THREE.TGALoader),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+o+'" is not supported.')}if("string"==typeof i)return"data:"+t+";base64,"+i;var r=new Uint8Array(i);return window.URL.createObjectURL(new Blob([r],{type:t}))},parseTextures:function(t){var i=new Map;if("Texture"in e.Objects){var n=e.Objects.Texture;for(var o in n){var r=this.parseTexture(n[o],t);i.set(parseInt(o),r)}}return i},parseTexture:function(e,t){var i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;var n=e.WrapModeU,o=e.WrapModeV,r=void 0!==n?n.value:0,a=void 0!==o?o.value:0;if(i.wrapS=0===r?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,i.wrapT=0===a?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in e){var s=e.Scaling.value;i.repeat.x=s[0],i.repeat.y=s[1]}return i},loadTexture:function(e,i){var n,o,r=this.textureLoader.path,a=t.get(e.id).children;void 0!==a&&a.length>0&&void 0!==i[a[0].ID]&&(0!==(n=i[a[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var s=e.FileName.slice(-3).toLowerCase();if("tga"===s){var c=THREE.Loader.Handlers.get(".tga");null===c?(console.warn("FBXLoader: TGALoader not found, creating empty placeholder texture for",n),o=new THREE.Texture):o=c.load(n)}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating empty placeholder texture for",n),o=new THREE.Texture):o=this.textureLoader.load(n);return this.textureLoader.setPath(r),o},parseMaterials:function(t){var i=new Map;if("Material"in e.Objects){var n=e.Objects.Material;for(var o in n){var r=this.parseMaterial(n[o],t);null!==r&&i.set(parseInt(o),r)}}return i},parseMaterial:function(e,i){var n=e.id,r=e.attrName,a=e.ShadingModel;if("object"===(void 0===a?"undefined":o(a))&&(a=a.value),!t.has(n))return null;var s,c=this.parseParameters(e,i,n);switch(a.toLowerCase()){case"phong":s=new THREE.MeshPhongMaterial;break;case"lambert":s=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),s=new THREE.MeshPhongMaterial({color:3342591})}return s.setValues(c),s.name=r,s},parseParameters:function(e,i,n){var o={};e.BumpFactor&&(o.bumpScale=e.BumpFactor.value),e.Diffuse?o.color=(new THREE.Color).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(o.color=(new THREE.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(o.displacementScale=e.DisplacementFactor.value),e.Emissive?o.emissive=(new THREE.Color).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(o.emissive=(new THREE.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(o.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(o.opacity=parseFloat(e.Opacity.value)),o.opacity<1&&(o.transparent=!0),e.ReflectionFactor&&(o.reflectivity=e.ReflectionFactor.value),e.Shininess&&(o.shininess=e.Shininess.value),e.Specular?o.specular=(new THREE.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(o.specular=(new THREE.Color).fromArray(e.SpecularColor.value));var r=this;return t.get(n).children.forEach(function(e){var t=e.relationship;switch(t){case"Bump":o.bumpMap=r.getTexture(i,e.ID);break;case"DiffuseColor":o.map=r.getTexture(i,e.ID);break;case"DisplacementColor":o.displacementMap=r.getTexture(i,e.ID);break;case"EmissiveColor":o.emissiveMap=r.getTexture(i,e.ID);break;case"NormalMap":o.normalMap=r.getTexture(i,e.ID);break;case"ReflectionColor":o.envMap=r.getTexture(i,e.ID),o.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case"SpecularColor":o.specularMap=r.getTexture(i,e.ID);break;case"TransparentColor":o.alphaMap=r.getTexture(i,e.ID),o.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}}),o},getTexture:function(i,n){return"LayeredTexture"in e.Objects&&n in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=t.get(n).children[0].ID),i.get(n)},parseDeformers:function(){var i={},n={};if("Deformer"in e.Objects){var o=e.Objects.Deformer;for(var r in o){var a=o[r],s=t.get(parseInt(r));if("Skin"===a.attrType){var c=this.parseSkeleton(s,o);c.ID=r,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),c.geometryID=s.parents[0].ID,i[r]=c}else if("BlendShape"===a.attrType){var l={id:r};l.rawTargets=this.parseMorphTargets(s,o),l.id=r,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[r]=l}}}return{skeletons:i,morphTargets:n}},parseSkeleton:function(e,t){var i=[];return e.children.forEach(function(e){var n=t[e.ID];if("Cluster"===n.attrType){var o={ID:e.ID,indices:[],weights:[],transform:(new THREE.Matrix4).fromArray(n.Transform.a),transformLink:(new THREE.Matrix4).fromArray(n.TransformLink.a),linkMode:n.Mode};"Indexes"in n&&(o.indices=n.Indexes.a,o.weights=n.Weights.a),i.push(o)}}),{rawBones:i,bones:[]}},parseMorphTargets:function(e,i){for(var n=[],o=0;o<e.children.length;o++){if(8===o){console.warn("FBXLoader: maximum of 8 morph targets supported. Ignoring additional targets.");break}var r=e.children[o],a=i[r.ID],s={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;t.get(parseInt(r.ID)).children.forEach(function(e){void 0===e.relationship&&(s.geoID=e.ID)}),n.push(s)}return n},parseScene:function(n,o,r){i=new THREE.Group;var a=this.parseModels(n.skeletons,o,r),c=e.Objects.Model,l=this;a.forEach(function(e){var n=c[e.ID];l.setLookAtProperties(e,n),t.get(e.ID).parents.forEach(function(t){var i=a.get(t.ID);void 0!==i&&i.add(e)}),null===e.parent&&i.add(e)}),this.bindSkeleton(n.skeletons,o,a),this.createAmbientLight(),this.setupMorphMaterials();var d=(new s).parse();1===i.children.length&&i.children[0].isGroup&&(i.children[0].animations=d,i=i.children[0]),i.animations=d},parseModels:function(i,n,o){var r=new Map,a=e.Objects.Model;for(var s in a){var c=parseInt(s),l=a[s],d=t.get(c),h=this.buildSkeleton(d,i,c,l.attrName);if(!h){switch(l.attrType){case"Camera":h=this.createCamera(d);break;case"Light":h=this.createLight(d);break;case"Mesh":h=this.createMesh(d,n,o);break;case"NurbsCurve":h=this.createCurve(d,n);break;case"LimbNode":case"Null":default:h=new THREE.Group}h.name=THREE.PropertyBinding.sanitizeNodeName(l.attrName),h.ID=c}this.setModelTransforms(h,l),r.set(c,h)}return r},buildSkeleton:function(e,t,i,n){var o=null;return e.parents.forEach(function(e){for(var r in t){var a=t[r];a.rawBones.forEach(function(t,r){if(t.ID===e.ID){var s=o;(o=new THREE.Bone).matrixWorld.copy(t.transformLink),o.name=THREE.PropertyBinding.sanitizeNodeName(n),o.ID=i,a.bones[r]=o,null!==s&&o.add(s)}})}}),o},createCamera:function(t){var i,n;if(t.children.forEach(function(t){var i=e.Objects.NodeAttribute[t.ID];void 0!==i&&(n=i)}),void 0===n)i=new THREE.Object3D;else{var o=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(o=1);var r=1;void 0!==n.NearPlane&&(r=n.NearPlane.value/1e3);var a=1e3;void 0!==n.FarPlane&&(a=n.FarPlane.value/1e3);var s=window.innerWidth,c=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,c=n.AspectHeight.value);var l=s/c,d=45;void 0!==n.FieldOfView&&(d=n.FieldOfView.value);var h=n.FocalLength?n.FocalLength.value:null;switch(o){case 0:i=new THREE.PerspectiveCamera(d,l,r,a),null!==h&&i.setFocalLength(h);break;case 1:i=new THREE.OrthographicCamera(-s/2,s/2,c/2,-c/2,r,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+o+"."),i=new THREE.Object3D}}return i},createLight:function(t){var i,n;if(t.children.forEach(function(t){var i=e.Objects.NodeAttribute[t.ID];void 0!==i&&(n=i)}),void 0===n)i=new THREE.Object3D;else{var o;o=void 0===n.LightType?0:n.LightType.value;var r=16777215;void 0!==n.Color&&(r=(new THREE.Color).fromArray(n.Color.value));var a=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(a=0);var s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);switch(o){case 0:i=new THREE.PointLight(r,a,s,1);break;case 1:i=new THREE.DirectionalLight(r,a);break;case 2:var c=Math.PI/3;void 0!==n.InnerAngle&&(c=THREE.MathUtils.degToRad(n.InnerAngle.value));var l=0;void 0!==n.OuterAngle&&(l=THREE.MathUtils.degToRad(n.OuterAngle.value),l=Math.max(l,1)),i=new THREE.SpotLight(r,a,s,c,l,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a THREE.PointLight."),i=new THREE.PointLight(r,a)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(i.castShadow=!0)}return i},createMesh:function(e,t,i){var n,o=null,r=null,a=[];return e.children.forEach(function(e){t.has(e.ID)&&(o=t.get(e.ID)),i.has(e.ID)&&a.push(i.get(e.ID))}),a.length>1?r=a:a.length>0?r=a[0]:(r=new THREE.MeshPhongMaterial({color:13421772}),a.push(r)),"color"in o.attributes&&a.forEach(function(e){e.vertexColors=THREE.VertexColors}),o.FBX_Deformer?(a.forEach(function(e){e.skinning=!0}),n=new THREE.SkinnedMesh(o,r)):n=new THREE.Mesh(o,r),n},createCurve:function(e,t){var i=e.children.reduce(function(e,i){return t.has(i.ID)&&(e=t.get(i.ID)),e},null),n=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(i,n)},setModelTransforms:function(e,t){var i={};"RotationOrder"in t&&(i.eulerOrder=parseInt(t.RotationOrder.value)),"Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value);var n=k(i);e.applyMatrix(n)},setLookAtProperties:function(n,o){"LookAtProperty"in o&&t.get(n.ID).children.forEach(function(t){if("LookAtProperty"===t.relationship){var o=e.Objects.Model[t.ID];if("Lcl_Translation"in o){var r=o.Lcl_Translation.value;void 0!==n.target?(n.target.position.fromArray(r),i.add(n.target)):n.lookAt((new THREE.Vector3).fromArray(r))}}})},bindSkeleton:function(e,i,n){var o=this.parsePoseNodes();for(var r in e){var a=e[r];t.get(parseInt(a.ID)).parents.forEach(function(e){if(i.has(e.ID)){var r=e.ID;t.get(r).parents.forEach(function(e){n.has(e.ID)&&n.get(e.ID).bind(new THREE.Skeleton(a.bones),o[e.ID])})}})}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var i=e.Objects.Pose;for(var n in i)if("BindPose"===i[n].attrType){var o=i[n].PoseNode;Array.isArray(o)?o.forEach(function(e){t[e.Node]=(new THREE.Matrix4).fromArray(e.Matrix.a)}):t[o.Node]=(new THREE.Matrix4).fromArray(o.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,n=t[0],o=t[1],r=t[2];if(0!==n||0!==o||0!==r){var a=new THREE.Color(n,o,r);i.add(new THREE.AmbientLight(a,1))}}},setupMorphMaterials:function(){i.traverse(function(e){if(e.isMesh&&(e.geometry.morphAttributes.position||e.geometry.morphAttributes.normal)){var t=e.uuid,n=e.material.uuid,o=!1;i.traverse(function(e){e.isMesh&&e.material.uuid===n&&e.uuid!==t&&(o=!0)}),!0===o&&(e.material=e.material.clone()),e.material.morphTargets=!0}})}},a.prototype={constructor:a,parse:function(i){var n=new Map;if("Geometry"in e.Objects){var o=e.Objects.Geometry;for(var r in o){var a=t.get(parseInt(r)),s=this.parseGeometry(a,o[r],i);n.set(parseInt(r),s)}}return n},parseGeometry:function(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,i,n){var o=n.skeletons,r=n.morphTargets,a=t.parents.map(function(t){return e.Objects.Model[t.ID]});if(0!==a.length){var s=t.children.reduce(function(e,t){return void 0!==o[t.ID]&&(e=o[t.ID]),e},null),c=t.children.reduce(function(e,t){return void 0!==r[t.ID]&&(e=r[t.ID]),e},null),l=a[0],d={};"RotationOrder"in l&&(d.eulerOrder=l.RotationOrder.value),"GeometricTranslation"in l&&(d.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(d.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(d.scale=l.GeometricScaling.value);var h=k(d);return this.genGeometry(i,s,c,h)}},genGeometry:function(e,t,i,n){var o=new THREE.BufferGeometry;e.attrName&&(o.name=e.attrName);var r=this.parseGeoNode(e,t),a=this.genBuffers(r),s=new THREE.Float32BufferAttribute(a.vertex,3);if(n.applyToBufferAttribute(s),o.addAttribute("position",s),a.colors.length>0&&o.addAttribute("color",new THREE.Float32BufferAttribute(a.colors,3)),t&&(o.addAttribute("skinIndex",new THREE.Uint16BufferAttribute(a.weightsIndices,4)),o.addAttribute("skinWeight",new THREE.Float32BufferAttribute(a.vertexWeights,4)),o.FBX_Deformer=t),a.normal.length>0){var c=new THREE.Float32BufferAttribute(a.normal,3);(new THREE.Matrix3).getNormalMatrix(n).applyToBufferAttribute(c),o.addAttribute("normal",c)}if(a.uvs.forEach(function(e,t){var i="uv"+(t+1).toString();0===t&&(i="uv"),o.addAttribute(i,new THREE.Float32BufferAttribute(a.uvs[t],2))}),r.material&&"AllSame"!==r.material.mappingType){var l=a.materialIndex[0],d=0;if(a.materialIndex.forEach(function(e,t){e!==l&&(o.addGroup(d,t-d,l),l=e,d=t)}),o.groups.length>0){var h=o.groups[o.groups.length-1],u=h.start+h.count;u!==a.materialIndex.length&&o.addGroup(u,a.materialIndex.length-u,l)}0===o.groups.length&&o.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(o,e,i,n),o},parseGeoNode:function(e,t){var i={};if(i.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],i.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];for(var n=0;e.LayerElementUV[n];)i.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return i.weightTable={},null!==t&&(i.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(n,o){void 0===i.weightTable[n]&&(i.weightTable[n]=[]),i.weightTable[n].push({id:t,weight:e.weights[o]})})})),i},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},i=0,n=0,o=!1,r=[],a=[],s=[],c=[],l=[],d=[],h=this;return e.vertexIndices.forEach(function(u,p){var f=!1;u<0&&(u^=-1,f=!0);var v=[],y=[];if(r.push(3*u,3*u+1,3*u+2),e.color){var g=m(p,i,u,e.color);s.push(g[0],g[1],g[2])}if(e.skeleton){if(void 0!==e.weightTable[u]&&e.weightTable[u].forEach(function(e){y.push(e.weight),v.push(e.id)}),y.length>4){o||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);var E=[0,0,0,0],b=[0,0,0,0];y.forEach(function(e,t){var i=e,n=v[t];b.forEach(function(e,t,o){if(i>e){o[t]=i,i=e;var r=E[t];E[t]=n,n=r}})}),v=E,y=b}for(;y.length<4;)y.push(0),v.push(0);for(var k=0;k<4;++k)l.push(y[k]),d.push(v[k])}if(e.normal){g=m(p,i,u,e.normal);a.push(g[0],g[1],g[2])}if(e.material&&"AllSame"!==e.material.mappingType)var w=m(p,i,u,e.material)[0];e.uv&&e.uv.forEach(function(e,t){var n=m(p,i,u,e);void 0===c[t]&&(c[t]=[]),c[t].push(n[0]),c[t].push(n[1])}),n++,f&&(h.genFace(t,e,r,w,a,s,c,l,d,n),i++,n=0,r=[],a=[],s=[],c=[],l=[],d=[])}),t},genFace:function(e,t,i,n,o,r,a,s,c,l){for(var d=2;d<l;d++)e.vertex.push(t.vertexPositions[i[0]]),e.vertex.push(t.vertexPositions[i[1]]),e.vertex.push(t.vertexPositions[i[2]]),e.vertex.push(t.vertexPositions[i[3*(d-1)]]),e.vertex.push(t.vertexPositions[i[3*(d-1)+1]]),e.vertex.push(t.vertexPositions[i[3*(d-1)+2]]),e.vertex.push(t.vertexPositions[i[3*d]]),e.vertex.push(t.vertexPositions[i[3*d+1]]),e.vertex.push(t.vertexPositions[i[3*d+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(d-1)]),e.vertexWeights.push(s[4*(d-1)+1]),e.vertexWeights.push(s[4*(d-1)+2]),e.vertexWeights.push(s[4*(d-1)+3]),e.vertexWeights.push(s[4*d]),e.vertexWeights.push(s[4*d+1]),e.vertexWeights.push(s[4*d+2]),e.vertexWeights.push(s[4*d+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[4*(d-1)]),e.weightsIndices.push(c[4*(d-1)+1]),e.weightsIndices.push(c[4*(d-1)+2]),e.weightsIndices.push(c[4*(d-1)+3]),e.weightsIndices.push(c[4*d]),e.weightsIndices.push(c[4*d+1]),e.weightsIndices.push(c[4*d+2]),e.weightsIndices.push(c[4*d+3])),t.color&&(e.colors.push(r[0]),e.colors.push(r[1]),e.colors.push(r[2]),e.colors.push(r[3*(d-1)]),e.colors.push(r[3*(d-1)+1]),e.colors.push(r[3*(d-1)+2]),e.colors.push(r[3*d]),e.colors.push(r[3*d+1]),e.colors.push(r[3*d+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(o[0]),e.normal.push(o[1]),e.normal.push(o[2]),e.normal.push(o[3*(d-1)]),e.normal.push(o[3*(d-1)+1]),e.normal.push(o[3*(d-1)+2]),e.normal.push(o[3*d]),e.normal.push(o[3*d+1]),e.normal.push(o[3*d+2])),t.uv&&t.uv.forEach(function(t,i){void 0===e.uvs[i]&&(e.uvs[i]=[]),e.uvs[i].push(a[i][0]),e.uvs[i].push(a[i][1]),e.uvs[i].push(a[i][2*(d-1)]),e.uvs[i].push(a[i][2*(d-1)+1]),e.uvs[i].push(a[i][2*d]),e.uvs[i].push(a[i][2*d+1])})},addMorphTargets:function(t,i,n,o){if(null!==n){t.morphAttributes.position=[],t.morphAttributes.normal=[];var r=this;n.rawTargets.forEach(function(n){var a=e.Objects.Geometry[n.geoID];void 0!==a&&r.genMorphGeometry(t,i,a,o)})}},genMorphGeometry:function(e,t,i,n){var o=new THREE.BufferGeometry;i.attrName&&(o.name=i.attrName);for(var r=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],a=void 0!==t.Vertices?t.Vertices.a.slice():[],s=void 0!==i.Vertices?i.Vertices.a:[],c=void 0!==i.Indexes?i.Indexes.a:[],l=0;l<c.length;l++){var d=3*c[l];a[d]+=s[3*l],a[d+1]+=s[3*l+1],a[d+2]+=s[3*l+2]}var h={vertexIndices:r,vertexPositions:a},u=this.genBuffers(h),p=new THREE.Float32BufferAttribute(u.vertex,3);p.name=i.attrName,n.applyToBufferAttribute(p),e.morphAttributes.position.push(p)},parseNormals:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Normals.a,o=[];return"IndexToDirect"===i&&("NormalIndex"in e?o=e.NormalIndex.a:"NormalsIndex"in e&&(o=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:o,mappingType:t,referenceType:i}},parseUVs:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.UV.a,o=[];return"IndexToDirect"===i&&(o=e.UVIndex.a),{dataSize:2,buffer:n,indices:o,mappingType:t,referenceType:i}},parseVertexColors:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Colors.a,o=[];return"IndexToDirect"===i&&(o=e.ColorIndex.a),{dataSize:4,buffer:n,indices:o,mappingType:t,referenceType:i}},parseMaterialIndices:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};for(var n=e.Materials.a,o=[],r=0;r<n.length;++r)o.push(r);return{dataSize:1,buffer:n,indices:o,mappingType:t,referenceType:i}},parseNurbsGeometry:function(e){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new THREE.BufferGeometry;for(var i,n,o=t-1,r=e.KnotVector.a,a=[],s=e.Points.a,c=0,l=s.length;c<l;c+=4)a.push((new THREE.Vector4).fromArray(s,c));if("Closed"===e.Form)a.push(a[0]);else if("Periodic"===e.Form){i=o,n=r.length-1-i;for(c=0;c<o;++c)a.push(a[c])}var d=new THREE.NURBSCurve(o,r,a,i,n).getPoints(7*a.length),h=new Float32Array(3*d.length);d.forEach(function(e,t){e.toArray(h,3*t)});var u=new THREE.BufferGeometry;return u.addAttribute("position",new THREE.BufferAttribute(h,3)),u}},s.prototype={constructor:s,parse:function(){var e=[],t=this.parseClips();if(void 0===t)return e;for(var i in t){var n=t[i],o=this.addClip(n);e.push(o)}return e},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var i=this.parseAnimationLayers(t);return this.parseAnimStacks(i)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,i=new Map;for(var n in t){var o=t[n];if(null!==o.attrName.match(/S|R|T|DeformPercent/)){var r={id:o.id,attr:o.attrName,curves:{}};i.set(r.id,r)}}return i},parseAnimationCurves:function(i){var n=e.Objects.AnimationCurve;for(var o in n){var r={id:n[o].id,times:n[o].KeyTime.a.map(p),values:n[o].KeyValueFloat.a},a=t.get(r.id);if(void 0!==a){var s=a.parents[0].ID,c=a.parents[0].relationship;c.match(/X/)?i.get(s).curves.x=r:c.match(/Y/)?i.get(s).curves.y=r:c.match(/Z/)?i.get(s).curves.z=r:c.match(/d|DeformPercent/)&&i.has(s)&&(i.get(s).curves.morph=r)}}},parseAnimationLayers:function(i){var n=e.Objects.AnimationLayer,o=new Map;for(var r in n){var a=[],s=t.get(parseInt(r));if(void 0!==s){var c=this;s.children.forEach(function(n,o){if(i.has(n.ID)){var r=i.get(n.ID);if(void 0!==r.curves.x||void 0!==r.curves.y||void 0!==r.curves.z){if(void 0===a[o]){t.get(n.ID).parents.forEach(function(e){void 0!==e.relationship&&(p=e.ID)});var s=e.Objects.Model[p.toString()],l={modelName:THREE.PropertyBinding.sanitizeNodeName(s.attrName),initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1],transform:c.getModelAnimTransform(s)};"PreRotation"in s&&(l.preRotations=s.PreRotation.value),"PostRotation"in s&&(l.postRotations=s.PostRotation.value),a[o]=l}a[o][r.attr]=r}else if(void 0!==r.curves.morph){if(void 0===a[o]){var d;t.get(n.ID).parents.forEach(function(e){void 0!==e.relationship&&(d=e.ID)});var h=t.get(d).parents[0].ID,u=t.get(h).parents[0].ID,p=t.get(u).parents[0].ID;s=e.Objects.Model[p],l={modelName:THREE.PropertyBinding.sanitizeNodeName(s.attrName),morphName:e.Objects.Deformer[d].attrName};a[o]=l}a[o][r.attr]=r}}}),o.set(parseInt(r),a)}}return o},getModelAnimTransform:function(e){var t={};return"RotationOrder"in e&&(t.eulerOrder=parseInt(e.RotationOrder.value)),"Lcl_Translation"in e&&(t.translation=e.Lcl_Translation.value),"RotationOffset"in e&&(t.rotationOffset=e.RotationOffset.value),"Lcl_Rotation"in e&&(t.rotation=e.Lcl_Rotation.value),"PreRotation"in e&&(t.preRotation=e.PreRotation.value),"PostRotation"in e&&(t.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(t.scale=e.Lcl_Scaling.value),k(t)},parseAnimStacks:function(i){var n=e.Objects.AnimationStack,o={};for(var r in n){var a=t.get(parseInt(r)).children;a.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=i.get(a[0].ID);o[r]={name:n[r].attrName,layer:s}}return o},addClip:function(e){var t=[],i=this;return e.layer.forEach(function(e){t=t.concat(i.generateTracks(e))}),new THREE.AnimationClip(e.name,-1,t)},generateTracks:function(e){var t=[],i=new THREE.Vector3,n=new THREE.Quaternion,o=new THREE.Vector3;if(e.transform&&e.transform.decompose(i,n,o),i=i.toArray(),n=(new THREE.Euler).setFromQuaternion(n).toArray(),o=o.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var r=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");void 0!==r&&t.push(r)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var a=this.generateRotationTrack(e.modelName,e.R.curves,n,e.preRotations,e.postRotations);void 0!==a&&t.push(a)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var s=this.generateVectorTrack(e.modelName,e.S.curves,o,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var c=this.generateMorphTrack(e);void 0!==c&&t.push(c)}return t},generateVectorTrack:function(e,t,i,n){var o=this.getTimesForAllAxes(t),r=this.getKeyframeTrackValues(o,t,i);return new THREE.VectorKeyframeTrack(e+"."+n,o,r)},generateRotationTrack:function(e,t,i,n,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(THREE.MathUtils.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(THREE.MathUtils.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(THREE.MathUtils.degToRad));var r=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(r,t,i);void 0!==n&&((n=n.map(THREE.MathUtils.degToRad)).push("ZYX"),n=(new THREE.Euler).fromArray(n),n=(new THREE.Quaternion).setFromEuler(n)),void 0!==o&&((o=o.map(THREE.MathUtils.degToRad)).push("ZYX"),o=(new THREE.Euler).fromArray(o),o=(new THREE.Quaternion).setFromEuler(o).inverse());for(var s=new THREE.Quaternion,c=new THREE.Euler,l=[],d=0;d<a.length;d+=3)c.set(a[d],a[d+1],a[d+2],"ZYX"),s.setFromEuler(c),void 0!==n&&s.premultiply(n),void 0!==o&&s.multiply(o),s.toArray(l,d/3*4);return new THREE.QuaternionKeyframeTrack(e+".quaternion",r,l)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,n=t.values.map(function(e){return e/100}),o=i.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new THREE.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+o+"]",t.times,n)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort(function(e,t){return e-t}).filter(function(e,t,i){return i.indexOf(e)==t})},getKeyframeTrackValues:function(e,t,i){var n=i,o=[],r=-1,a=-1,s=-1;return e.forEach(function(e){if(t.x&&(r=t.x.times.indexOf(e)),t.y&&(a=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==r){var i=t.x.values[r];o.push(i),n[0]=i}else o.push(n[0]);if(-1!==a){var c=t.y.values[a];o.push(c),n[1]=c}else o.push(n[1]);if(-1!==s){var l=t.z.values[s];o.push(l),n[2]=l}else o.push(n[2])}),o},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var i=e.values[t-1],n=e.values[t]-i,o=Math.abs(n);if(o>=180){for(var r=o/180,a=n/r,s=i+a,c=e.times[t-1],l=(e.times[t]-c)/r,d=c+l,h=[],u=[];d<e.times[t];)h.push(d),d+=l,u.push(s),s+=a;e.times=A(e.times,t,h),e.values=A(e.values,t,u)}}}},c.prototype={constructor:c,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,console.log("FBXTree: ",h),this.allNodes=new h,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,i=e.split(/[\r\n]+/);return i.forEach(function(e,n){var o=e.match(/^[\s\t]*;/),r=e.match(/^[\s\t]*$/);if(!o&&!r){var a=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=e.match("^\\t{"+(t.currentIndent-1)+"}}");a?t.parseNodeBegin(e,a):s?t.parseNodeProperty(e,s,i[++n]):c?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}}),this.allNodes},parseNodeBegin:function(e,t){var i=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),o={name:i},r=this.parseNodeAttr(n),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(i,o):i in a?("PoseNode"===i?a.PoseNode.push(o):void 0!==a[i].id&&(a[i]={},a[i][a[i].id]=a[i]),""!==r.id&&(a[i][r.id]=o)):"number"==typeof r.id?(a[i]={},a[i][r.id]=o):"Properties70"!==i&&(a[i]="PoseNode"===i?[o]:o),"number"==typeof r.id&&(o.id=r.id),""!==r.name&&(o.attrName=r.name),""!==r.type&&(o.attrType=r.type),this.pushStack(o)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var i="",n="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:i,type:n}},parseNodeProperty:function(e,t,i){var n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),o=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===o&&(o=i.replace(/"/g,"").replace(/,$/,"").trim());var r=this.getCurrentNode();if("Properties70"!==r.name){if("C"===n){var a=o.split(",").slice(1),s=parseInt(a[0]),c=parseInt(a[1]),l=o.split(",").slice(3);n="connections",function(e,t){for(var i=0,n=e.length,o=t.length;i<o;i++,n++)e[n]=t[i]}(o=[s,c],l=l.map(function(e){return e.trim().replace(/^"/,"")})),void 0===r[n]&&(r[n]=[])}"Node"===n&&(r.id=o),n in r&&Array.isArray(r[n])?r[n].push(o):"a"!==n?r[n]=o:r.a=o,this.setCurrentProp(r,n),"a"===n&&","!==o.slice(-1)&&(r.a=T(o))}else this.parseNodeSpecialProperty(e,n,o)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=T(t.a))},parseNodeSpecialProperty:function(e,t,i){var n=i.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),o=n[0],r=n[1],a=n[2],s=n[3],c=n[4];switch(r){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=T(c)}this.getPrevNode()[o]={type:r,type2:a,flag:s,value:c},this.setCurrentProp(this.getPrevNode(),o)}},l.prototype={constructor:l,parse:function(e){var t=new d(e);t.skip(23);var i=t.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+i);for(var n=new h;!this.endOfContent(t);){var o=this.parseNode(t,i);null!==o&&n.add(o.name,o)}return n},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var i={},n=t>=7500?e.getUint64():e.getUint32(),o=t>=7500?e.getUint64():e.getUint32(),r=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),a=e.getString(r);if(0===n)return null;for(var s=[],c=0;c<o;c++)s.push(this.parseProperty(e));var l=s.length>0?s[0]:"",d=s.length>1?s[1]:"",h=s.length>2?s[2]:"";for(i.singleProperty=1===o&&e.getOffset()===n;n>e.getOffset();){var u=this.parseNode(e,t);null!==u&&this.parseSubNode(a,i,u)}return i.propertyList=s,"number"==typeof l&&(i.id=l),""!==d&&(i.attrName=d),""!==h&&(i.attrType=h),""!==a&&(i.name=a),i},parseSubNode:function(e,t,i){if(!0===i.singleProperty){var n=i.propertyList[0];Array.isArray(n)?(t[i.name]=i,i.a=n):t[i.name]=n}else if("Connections"===e&&"C"===i.name){var o=[];i.propertyList.forEach(function(e,t){0!==t&&o.push(e)}),void 0===t.connections&&(t.connections=[]),t.connections.push(o)}else if("Properties70"===i.name){Object.keys(i).forEach(function(e){t[e]=i[e]})}else if("Properties70"===e&&"P"===i.name){var r,a=i.propertyList[0],s=i.propertyList[1],c=i.propertyList[2],l=i.propertyList[3];0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),r="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:i.propertyList[4],t[a]={type:s,type2:c,flag:l,value:r}}else void 0===t[i.name]?"number"==typeof i.id?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:"PoseNode"===i.name?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):void 0===t[i.name][i.id]&&(t[i.name][i.id]=i)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var i=e.getUint32();return e.getArrayBuffer(i);case"S":i=e.getUint32();return e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var n=e.getUint32(),o=e.getUint32(),r=e.getUint32();if(0===o)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}"undefined"==typeof Zlib&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var a=new d(new Zlib.Inflate(new Uint8Array(e.getArrayBuffer(r))).decompress().buffer);switch(t){case"b":case"c":return a.getBooleanArray(n);case"d":return a.getFloat64Array(n);case"f":return a.getFloat32Array(n);case"i":return a.getInt32Array(n);case"l":return a.getInt64Array(n)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},d.prototype={constructor:d,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],i=0;i<e;i++)t[i]=this.getUint8();var n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),THREE.LoaderUtils.decodeText(new Uint8Array(t))}},h.prototype={constructor:h,add:function(e,t){this[e]=t}};var f=[];function m(e,t,i,n){var o;switch(n.mappingType){case"ByPolygonVertex":o=e;break;case"ByPolygon":o=t;break;case"ByVertice":o=i;break;case"AllSame":o=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(o=n.indices[o]);var r=o*n.dataSize,a=r+n.dataSize;return function(e,t,i,n){for(var o=i,r=0;o<n;o++,r++)e[r]=t[o];return e}(f,n.buffer,r,a)}var v=new THREE.Matrix4,y=new THREE.Euler,g=new THREE.Vector3,E=new THREE.Vector3,b=new THREE.Matrix4;function k(e){var t=new THREE.Matrix4;E.set(0,0,0),b.identity();var i,n=e.eulerOrder?w(e.eulerOrder):w(0);(e.translation&&E.fromArray(e.translation),e.rotationOffset&&E.add(g.fromArray(e.rotationOffset)),e.rotation)&&((i=e.rotation.map(THREE.MathUtils.degToRad)).push(n),b.makeRotationFromEuler(y.fromArray(i)));e.preRotation&&((i=e.preRotation.map(THREE.MathUtils.degToRad)).push(n),v.makeRotationFromEuler(y.fromArray(i)),b.premultiply(v));e.postRotation&&((i=e.postRotation.map(THREE.MathUtils.degToRad)).push(n),v.makeRotationFromEuler(y.fromArray(i)),v.getInverse(v),b.multiply(v));return e.scale&&t.scale(g.fromArray(e.scale)),t.setPosition(E),t.multiply(b),t}function w(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===e?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function T(e){return e.split(",").map(function(e){return parseFloat(e)})}function x(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=e.byteLength),THREE.LoaderUtils.decodeText(new Uint8Array(e,t,i))}function A(e,t,i){return e.slice(0,t).concat(i).concat(e.slice(t))}return n}()},{}],5:[function(e,t,i){"use strict";t.exports=Object.assign(function(){},{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L_SHOULDER_1:4,R_SHOULDER_1:5,L_SHOULDER_2:6,R_SHOULDER_2:7,SELECT:8,START:9,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15,VENDOR:16})},{}],6:[function(e,t,i){"use strict";t.exports=function(e,t,i){this.type=e,this.index=t,this.pressed=i.pressed,this.value=i.value}},{}],7:[function(e,t,i){"use strict";function n(e){var t=document.getElementById(e),i=t.parentNode;try{i&&i.removeChild(t)}catch(e){}}function o(e,t,i){return new i(function(i,o){var r=t.timeout||5e3,a="script_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),s=function(e,t){var i=document.createElement("script");return i.type="text/javascript",i.async=!0,i.id=t,i.src=e,i}(e,a),c=setTimeout(function(){o(new Error("Script request to "+e+" timed out")),n(a)},r),l=function(e){clearTimeout(e)};s.addEventListener("load",function(e){i({ok:!0}),l(c),n(a)}),s.addEventListener("error",function(t){o(new Error("Script request to "+e+" failed "+t)),l(c),n(a)}),function(e){var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(s)})}t.exports=function(e){return e=e||{},function(t,i){return o(t,i=i||{},e.Promise||Promise)}}},{}],8:[function(e,t,i){"use strict";!function(e){var t="KeyboardEvent"in e;t||(e.KeyboardEvent=function(){throw TypeError("Illegal constructor")}),"DOM_KEY_LOCATION_STANDARD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_STANDARD=0),"DOM_KEY_LOCATION_LEFT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_LEFT=1),"DOM_KEY_LOCATION_RIGHT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_RIGHT=2),"DOM_KEY_LOCATION_NUMPAD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD=3);var i=window.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,n=window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,o=window.KeyboardEvent.DOM_KEY_LOCATION_RIGHT,r=window.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD;function a(e,t){return-1!==String(e).indexOf(t)}var s=a(navigator.platform,"Win")?"win":a(navigator.platform,"Mac")?"mac":a(navigator.platform,"CrOS")?"cros":a(navigator.platform,"Linux")?"linux":a(navigator.userAgent,"iPad")||a(navigator.platform,"iPod")||a(navigator.platform,"iPhone")?"ios":"",c=a(navigator.userAgent,"Chrome/")?"chrome":a(navigator.vendor,"Apple")?"safari":a(navigator.userAgent,"MSIE")?"ie":a(navigator.userAgent,"Gecko/")?"moz":a(navigator.userAgent,"Opera/")?"opera":"",l=c+"-"+s;function d(e,t,i){l!==t&&c!==t&&s!==t||Object.keys(i).forEach(function(t){e[t]=i[t]})}var h={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"HangulMode"},23:{code:"JunjaMode"},24:{code:"FinalMode"},25:{code:"KanjiMode"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"OSLeft",location:n},92:{code:"OSRight",location:o},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0",location:r},97:{code:"Numpad1",keyCap:"1",location:r},98:{code:"Numpad2",keyCap:"2",location:r},99:{code:"Numpad3",keyCap:"3",location:r},100:{code:"Numpad4",keyCap:"4",location:r},101:{code:"Numpad5",keyCap:"5",location:r},102:{code:"Numpad6",keyCap:"6",location:r},103:{code:"Numpad7",keyCap:"7",location:r},104:{code:"Numpad8",keyCap:"8",location:r},105:{code:"Numpad9",keyCap:"9",location:r},106:{code:"NumpadMultiply",keyCap:"*",location:r},107:{code:"NumpadAdd",keyCap:"+",location:r},108:{code:"NumpadComma",keyCap:",",location:r},109:{code:"NumpadSubtract",keyCap:"-",location:r},110:{code:"NumpadDecimal",keyCap:".",location:r},111:{code:"NumpadDivide",keyCap:"/",location:r},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock",location:r},145:{code:"ScrollLock"},160:{code:"ShiftLeft",location:n},161:{code:"ShiftRight",location:o},162:{code:"ControlLeft",location:n},163:{code:"ControlRight",location:o},164:{code:"AltLeft",location:n},165:{code:"AltRight",location:o},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"VolumeMute"},174:{code:"VolumeDown"},175:{code:"VolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};d(h,"moz",{59:{code:"Semicolon",keyCap:";"},61:{code:"Equal",keyCap:"="},107:{code:"Equal",keyCap:"="},109:{code:"Minus",keyCap:"-"},187:{code:"NumpadAdd",keyCap:"+",location:r},189:{code:"NumpadSubtract",keyCap:"-",location:r}}),d(h,"moz-mac",{12:{code:"NumLock",location:r},173:{code:"Minus",keyCap:"-"}}),d(h,"moz-win",{173:{code:"Minus",keyCap:"-"}}),d(h,"chrome-mac",{93:{code:"OSRight",location:o}}),d(h,"safari",{3:{code:"Enter"},25:{code:"Tab"}}),d(h,"ios",{10:{code:"Enter",location:i}}),d(h,"safari-mac",{91:{code:"OSLeft",location:n},93:{code:"OSRight",location:o},229:{code:"KeyQ",keyCap:"Q"}});var u={};"cros"===s&&(u["U+00A0"]={code:"ShiftLeft",location:n},u["U+00A1"]={code:"ShiftRight",location:o},u["U+00A2"]={code:"ControlLeft",location:n},u["U+00A3"]={code:"ControlRight",location:o},u["U+00A4"]={code:"AltLeft",location:n},u["U+00A5"]={code:"AltRight",location:o}),"chrome-mac"===l&&(u["U+0010"]={code:"ContextMenu"}),"safari-mac"===l&&(u["U+0010"]={code:"ContextMenu"}),"ios"===s&&(u["U+0010"]={code:"Function"},u["U+001C"]={code:"ArrowLeft"},u["U+001D"]={code:"ArrowRight"},u["U+001E"]={code:"ArrowUp"},u["U+001F"]={code:"ArrowDown"},u["U+0001"]={code:"Home"},u["U+0004"]={code:"End"},u["U+000B"]={code:"PageUp"},u["U+000C"]={code:"PageDown"});var p=[];p[n]={16:{code:"ShiftLeft",location:n},17:{code:"ControlLeft",location:n},18:{code:"AltLeft",location:n}},p[o]={16:{code:"ShiftRight",location:o},17:{code:"ControlRight",location:o},18:{code:"AltRight",location:o}},p[r]={13:{code:"NumpadEnter",location:r}},d(p[r],"moz",{109:{code:"NumpadSubtract",location:r},107:{code:"NumpadAdd",location:r}}),d(p[n],"moz-mac",{224:{code:"OSLeft",location:n}}),d(p[o],"moz-mac",{224:{code:"OSRight",location:o}}),d(p[o],"moz-win",{91:{code:"OSRight",location:o}}),d(p[o],"mac",{93:{code:"OSRight",location:o}}),d(p[r],"chrome-mac",{12:{code:"NumLock",location:r}}),d(p[r],"safari-mac",{12:{code:"NumLock",location:r},187:{code:"NumpadAdd",location:r},189:{code:"NumpadSubtract",location:r},190:{code:"NumpadDecimal",location:r},191:{code:"NumpadDivide",location:r}});var f={ShiftLeft:{key:"Shift"},ShiftRight:{key:"Shift"},ControlLeft:{key:"Control"},ControlRight:{key:"Control"},AltLeft:{key:"Alt"},AltRight:{key:"Alt"},OSLeft:{key:"OS"},OSRight:{key:"OS"},NumpadEnter:{key:"Enter"},Space:{key:" "},Digit0:{key:"0",shiftKey:")"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},KeyA:{key:"a",shiftKey:"A"},KeyB:{key:"b",shiftKey:"B"},KeyC:{key:"c",shiftKey:"C"},KeyD:{key:"d",shiftKey:"D"},KeyE:{key:"e",shiftKey:"E"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyI:{key:"i",shiftKey:"I"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},KeyM:{key:"m",shiftKey:"M"},KeyN:{key:"n",shiftKey:"N"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},KeyQ:{key:"q",shiftKey:"Q"},KeyR:{key:"r",shiftKey:"R"},KeyS:{key:"s",shiftKey:"S"},KeyT:{key:"t",shiftKey:"T"},KeyU:{key:"u",shiftKey:"U"},KeyV:{key:"v",shiftKey:"V"},KeyW:{key:"w",shiftKey:"W"},KeyX:{key:"x",shiftKey:"X"},KeyY:{key:"y",shiftKey:"Y"},KeyZ:{key:"z",shiftKey:"Z"},Numpad0:{key:"0"},Numpad1:{key:"1"},Numpad2:{key:"2"},Numpad3:{key:"3"},Numpad4:{key:"4"},Numpad5:{key:"5"},Numpad6:{key:"6"},Numpad7:{key:"7"},Numpad8:{key:"8"},Numpad9:{key:"9"},NumpadMultiply:{key:"*"},NumpadAdd:{key:"+"},NumpadComma:{key:","},NumpadSubtract:{key:"-"},NumpadDecimal:{key:"."},NumpadDivide:{key:"/"},Semicolon:{key:";",shiftKey:":"},Equal:{key:"=",shiftKey:"+"},Comma:{key:",",shiftKey:"<"},Minus:{key:"-",shiftKey:"_"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},Backquote:{key:"`",shiftKey:"~"},BracketLeft:{key:"[",shiftKey:"{"},Backslash:{key:"\\",shiftKey:"|"},BracketRight:{key:"]",shiftKey:"}"},Quote:{key:"'",shiftKey:'"'},IntlBackslash:{key:"\\",shiftKey:"|"}};d(f,"mac",{OSLeft:{key:"Meta"},OSRight:{key:"Meta"}});var m,v,y,g={Esc:"Escape",Nonconvert:"NonConvert",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Menu:"ContextMenu",MediaNextTrack:"MediaTrackNext",MediaPreviousTrack:"MediaTrackPrevious",SelectMedia:"MediaSelect",HalfWidth:"Hankaku",FullWidth:"Zenkaku",RomanCharacters:"Romaji",Crsel:"CrSel",Exsel:"ExSel",Zoom:"ZoomToggle"},E=(m=h,v="code",y={},Object.keys(m).forEach(function(e){var t=m[e];v in t&&(y[t[v]]=t)}),y);try{var b=t&&"location"in new KeyboardEvent("")}catch(e){}function k(e){var t="keyCode"in e?e.keyCode:"which"in e?e.which:0,i=function(){if(b||"keyLocation"in e){var i=b?e.location:e.keyLocation;if(i&&t in p[i])return p[i][t]}return"keyIdentifier"in e&&e.keyIdentifier in u?u[e.keyIdentifier]:t in h?h[t]:null}();if(!i)return null;var n,o=(n=f[i.code])?e.shiftKey&&"shiftKey"in n?n.shiftKey:n.key:i.code;return{code:i.code,key:o,location:i.location,keyCap:i.keyCap}}"KeyboardEvent"in e&&"defineProperty"in Object&&function(){function e(e,t,i){t in e||Object.defineProperty(e,t,i)}if(e(KeyboardEvent.prototype,"code",{get:function(){var e=k(this);return e?e.code:""}}),"key"in KeyboardEvent.prototype){var t=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key");Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){var e=t.get.call(this);return g.hasOwnProperty(e)?g[e]:e}})}e(KeyboardEvent.prototype,"key",{get:function(){var e=k(this);return e&&"key"in e?e.key:"Unidentified"}}),e(KeyboardEvent.prototype,"location",{get:function(){var e=k(this);return e&&"location"in e?e.location:i}}),e(KeyboardEvent.prototype,"locale",{get:function(){return""}})}(),"queryKeyCap"in e.KeyboardEvent||(e.KeyboardEvent.queryKeyCap=function(e,t){if(e=String(e),!E.hasOwnProperty(e))return"Undefined";if(t&&"en-us"!==String(t).toLowerCase())throw Error("Unsupported locale");var i=E[e];return i.keyCap||i.code||"Undefined"}),e.identifyKey=function(e){if(!("code"in e)){var t=k(e);e.code=t?t.code:"",e.key=t&&"key"in t?t.key:"Unidentified",e.location="location"in e?e.location:"keyLocation"in e?e.keyLocation:t&&"location"in t?t.location:i,e.locale=""}}}(window)},{}],9:[function(e,t,i){var n,o;n=window,o=function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);var n,o=function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},r=function(e){return e*(Math.PI/180)},a=new Map,s=function(e){a.has(e)&&clearTimeout(a.get(e)),a.set(e,setTimeout(e,100))},c=function(e,t,i){for(var n,o=t.split(/[ ,]+/g),r=0;r<o.length;r+=1)n=o[r],e.addEventListener?e.addEventListener(n,i,!1):e.attachEvent&&e.attachEvent(n,i)},l=function(e,t,i){for(var n,o=t.split(/[ ,]+/g),r=0;r<o.length;r+=1)n=o[r],e.removeEventListener?e.removeEventListener(n,i):e.detachEvent&&e.detachEvent(n,i)},d=function(e){return e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e},h=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},u=function(e,t){t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},p=function(e,t,i){var n=f(e);for(var o in n)if(n.hasOwnProperty(o))if("string"==typeof t)n[o]=t+" "+i;else{for(var r="",a=0,s=t.length;a<s;a+=1)r+=t[a]+" "+i+", ";n[o]=r.slice(0,-2)}return n},f=function(e){var t={};return t[e]="",["webkit","Moz","o"].forEach(function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},m=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},v=function(e,t){if(e.length)for(var i=0,n=e.length;i<n;i+=1)t(e[i]);else t(e)},y=!!("ontouchstart"in window),g=!!window.PointerEvent,E=!!window.MSPointerEvent,b={start:"mousedown",move:"mousemove",end:"mouseup"},k={};function w(){}g?n={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:E?n={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:y?(n={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},k=b):n=b,w.prototype.on=function(e,t){var i,n=e.split(/[ ,]+/g);this._handlers_=this._handlers_||{};for(var o=0;o<n.length;o+=1)i=n[o],this._handlers_[i]=this._handlers_[i]||[],this._handlers_[i].push(t);return this},w.prototype.off=function(e,t){return this._handlers_=this._handlers_||{},void 0===e?this._handlers_={}:void 0===t?this._handlers_[e]=null:this._handlers_[e]&&this._handlers_[e].indexOf(t)>=0&&this._handlers_[e].splice(this._handlers_[e].indexOf(t),1),this},w.prototype.trigger=function(e,t){var i,n=this,o=e.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var r=0;r<o.length;r+=1)i=o[r],n._handlers_[i]&&n._handlers_[i].length&&n._handlers_[i].forEach(function(e){e.call(n,{type:i,target:n},t)})},w.prototype.config=function(e){this.options=this.defaults||{},e&&(this.options=function(e,t){var i={};for(var n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)?i[n]=t[n]:e.hasOwnProperty(n)&&(i[n]=e[n]);return i}(this.options,e))},w.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){"function"==typeof i["on"+t]?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},c(e,n[t],i._domHandlers_[t]),k[t]&&c(e,k[t],i._domHandlers_[t]),i},w.prototype.unbindEvt=function(e,t){return this._domHandlers_=this._domHandlers_||{},l(e,n[t],this._domHandlers_[t]),k[t]&&l(e,k[t],this._domHandlers_[t]),delete this._domHandlers_[t],this};var T=w;function x(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=x.id,x.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}x.prototype=new T,x.constructor=x,x.id=0,x.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},x.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=function(e,t){var i=f("borderRadius");for(var n in i)i.hasOwnProperty(n)&&(i[n]="50%");return i}(),i=p("transition","opacity",e),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},m(n.el,i),"circle"===this.options.shape&&m(n.back,t),m(n.front,t),this.applyStyles(n),this},x.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this},x.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},x.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},x.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},x.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),"function"==typeof e&&e.call(this)},t.options.fadeTime)),t},x.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i="dynamic"===t.options.mode?"none":"block";t.ui.el.style.display=i,"function"==typeof e&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){var i=t.options.restJoystick,n={};n.x=!0===i||!1!==i.x?0:t.instance.frontPosition.x,n.y=!0===i||!1!==i.y?0:t.instance.frontPosition.y,t.setPosition(e,n)}return t},x.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var n=i.options.fadeTime+"ms",o={};o.front=p("transition",["transform"],n);var r={front:{}};r.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(o),i.applyStyles(r),i.restTimeout=setTimeout(function(){"function"==typeof e&&e.call(i),i.restCallback()},i.options.fadeTime)},x.prototype.restCallback=function(){var e={};e.front=p("transition","none",""),this.applyStyles(e),this.trigger("rested",this.instance)},x.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},x.prototype.computeDirection=function(e){var t,i,n,o=e.angle.radian,r=Math.PI/4,a=Math.PI/2;if(o>r&&o<3*r&&!e.lockX?t="up":o>-r&&o<=r&&!e.lockY?t="left":o>3*-r&&o<=-r&&!e.lockX?t="down":e.lockY||(t="right"),e.lockY||(i=o>-a&&o<a?"left":"right"),e.lockX||(n=o>0?"up":"down"),e.force>this.options.threshold){var s,c={};for(s in this.direction)this.direction.hasOwnProperty(s)&&(c[s]=this.direction[s]);var l={};for(s in this.direction={x:i,y:n,angle:t},e.direction=this.direction,c)c[s]===this.direction[s]&&(l[s]=!0);if(l.x&&l.y&&l.angle)return e;l.x&&l.y||this.trigger("plain",e),l.x||this.trigger("plain:"+i,e),l.y||this.trigger("plain:"+n,e),l.angle||this.trigger("dir dir:"+t,e)}else this.resetDirection();return e};var A=x;function R(e,t){this.nipples=[],this.idles=[],this.actives=[],this.ids=[],this.pressureIntervals={},this.manager=e,this.id=R.id,R.id+=1,this.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},this.config(t),"static"!==this.options.mode&&"semi"!==this.options.mode||(this.options.multitouch=!1),this.options.multitouch||(this.options.maxNumberOfNipples=1);var i=getComputedStyle(this.options.zone.parentElement);return i&&"flex"===i.display&&(this.parentIsFlex=!0),this.updateBox(),this.prepareNipples(),this.bindings(),this.begin(),this.nipples}R.prototype=new T,R.constructor=R,R.id=0,R.prototype.prepareNipples=function(){var e=this.nipples;e.on=this.on.bind(this),e.off=this.off.bind(this),e.options=this.options,e.destroy=this.destroy.bind(this),e.ids=this.ids,e.id=this.id,e.processOnMove=this.processOnMove.bind(this),e.processOnEnd=this.processOnEnd.bind(this),e.get=function(t){if(void 0===t)return e[0];for(var i=0,n=e.length;i<n;i+=1)if(e[i].identifier===t)return e[i];return!1}},R.prototype.bindings=function(){this.bindEvt(this.options.zone,"start"),this.options.zone.style.touchAction="none",this.options.zone.style.msTouchAction="none"},R.prototype.begin=function(){var e=this.options;if("static"===e.mode){var t=this.createNipple(e.position,this.manager.getIdentifier());t.add(),this.idles.push(t)}},R.prototype.createNipple=function(e,t){var i=this.manager.scroll,n={},o=this.options,r=this.parentIsFlex?i.x:i.x+this.box.left,a=this.parentIsFlex?i.y:i.y+this.box.top;if(e.x&&e.y)n={x:e.x-r,y:e.y-a};else if(e.top||e.right||e.bottom||e.left){var s=document.createElement("DIV");s.style.display="hidden",s.style.top=e.top,s.style.right=e.right,s.style.bottom=e.bottom,s.style.left=e.left,s.style.position="absolute",o.zone.appendChild(s);var c=s.getBoundingClientRect();o.zone.removeChild(s),n=e,e={x:c.left+i.x,y:c.top+i.y}}var l=new A(this,{color:o.color,size:o.size,threshold:o.threshold,fadeTime:o.fadeTime,dataOnly:o.dataOnly,restJoystick:o.restJoystick,restOpacity:o.restOpacity,mode:o.mode,identifier:t,position:e,zone:o.zone,frontPosition:{x:0,y:0},shape:o.shape});return o.dataOnly||(u(l.ui.el,n),u(l.ui.front,l.frontPosition)),this.nipples.push(l),this.trigger("added "+l.identifier+":added",l),this.manager.trigger("added "+l.identifier+":added",l),this.bindNipple(l),l},R.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},R.prototype.bindNipple=function(e){var t,i=this,n=function(e,n){t=e.type+" "+n.id+":"+e.type,i.trigger(t,n)};e.on("destroyed",i.onDestroyed.bind(i)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)},R.prototype.pressureFn=function(e,t,i){var n=this,o=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval(function(){var i=e.force||e.pressure||e.webkitForce||0;i!==o&&(t.trigger("pressure",i),n.trigger("pressure "+t.identifier+":pressure",i),o=i)}.bind(n),100)},R.prototype.onstart=function(e){var t=this,i=t.options,n=e;return e=d(e),t.updateBox(),v(e,function(o){t.actives.length<i.maxNumberOfNipples?t.processOnStart(o):n.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(i){if(Object.values(n.touches).findIndex(function(e){return e.identifier===i})<0){var o=[e[0]];o.identifier=i,t.processOnEnd(o)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(o))}),t.manager.bindDocument(),!1},R.prototype.processOnStart=function(e){var t,i=this,n=i.options,r=i.manager.getIdentifier(e),a=e.force||e.pressure||e.webkitForce||0,s={x:e.pageX,y:e.pageY},c=i.getOrCreate(r,s);c.identifier!==r&&i.manager.removeIdentifier(c.identifier),c.identifier=r;var l=function(t){t.trigger("start",t),i.trigger("start "+t.id+":start",t),t.show(),a>0&&i.pressureFn(e,t,t.identifier),i.processOnMove(e)};if((t=i.idles.indexOf(c))>=0&&i.idles.splice(t,1),i.actives.push(c),i.ids.push(c.identifier),"semi"!==n.mode)l(c);else{if(!(o(s,c.position)<=n.catchDistance))return c.destroy(),void i.processOnStart(e);l(c)}return c},R.prototype.getOrCreate=function(e,t){var i,n=this.options;return/(semi|static)/.test(n.mode)?(i=this.idles[0])?(this.idles.splice(0,1),i):"semi"===n.mode?this.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1):i=this.createNipple(t,e)},R.prototype.processOnMove=function(e){var t=this.options,i=this.manager.getIdentifier(e),n=this.nipples.get(i),a=this.manager.scroll;if(function(e){return isNaN(e.buttons)?0!==e.pressure:0!==e.buttons}(e)){if(!n)return console.error("Found zombie joystick with ID "+i),void this.manager.removeIdentifier(i);if(t.dynamicPage){var s=n.el.getBoundingClientRect();n.position={x:a.x+s.left,y:a.y+s.top}}n.identifier=i;var c=n.options.size/2,l={x:e.pageX,y:e.pageY};t.lockX&&(l.y=n.position.y),t.lockY&&(l.x=n.position.x);var d,h,u,p,f,m,v,y,g,E,b=o(l,n.position),k=(d=l,u=(h=n.position).x-d.x,p=h.y-d.y,function(e){return e*(180/Math.PI)}(Math.atan2(p,u))),w=r(k),T=b/c,x={distance:b,position:l};if("circle"===n.options.shape?(f=Math.min(b,c),v=n.position,y=f,E={x:0,y:0},g=r(g=k),E.x=v.x-y*Math.cos(g),E.y=v.y-y*Math.sin(g),m=E):(m=function(e,t,i){return{x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)}}(l,n.position,c),f=o(m,n.position)),t.follow){if(b>c){var A=l.x-m.x,R=l.y-m.y;n.position.x+=A,n.position.y+=R,n.el.style.top=n.position.y-(this.box.top+a.y)+"px",n.el.style.left=n.position.x-(this.box.left+a.x)+"px",b=o(l,n.position)}}else l=m,b=f;var N=l.x-n.position.x,M=l.y-n.position.y;n.frontPosition={x:N,y:M},t.dataOnly||(n.ui.front.style.transform="translate("+N+"px,"+M+"px)");var C={identifier:n.identifier,position:l,force:T,pressure:e.force||e.pressure||e.webkitForce||0,distance:b,angle:{radian:w,degree:k},vector:{x:N/c,y:-M/c},raw:x,instance:n,lockX:t.lockX,lockY:t.lockY};(C=n.computeDirection(C)).angle={radian:r(180-k),degree:180-k},n.trigger("move",C),this.trigger("move "+n.id+":move",C)}else this.processOnEnd(e)},R.prototype.processOnEnd=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),o=t.nipples.get(n),r=t.manager.removeIdentifier(o.identifier);o&&(i.dataOnly||o.hide(function(){"dynamic"===i.mode&&(o.trigger("removed",o),t.trigger("removed "+o.id+":removed",o),t.manager.trigger("removed "+o.id+":removed",o),o.destroy())}),clearInterval(t.pressureIntervals[o.identifier]),o.resetDirection(),o.trigger("end",o),t.trigger("end "+o.id+":end",o),t.ids.indexOf(o.identifier)>=0&&t.ids.splice(t.ids.indexOf(o.identifier),1),t.actives.indexOf(o)>=0&&t.actives.splice(t.actives.indexOf(o),1),/(semi|static)/.test(i.mode)?t.idles.push(o):t.nipples.indexOf(o)>=0&&t.nipples.splice(t.nipples.indexOf(o),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[r.id]=r.identifier))},R.prototype.onDestroyed=function(e,t){this.nipples.indexOf(t)>=0&&this.nipples.splice(this.nipples.indexOf(t),1),this.actives.indexOf(t)>=0&&this.actives.splice(this.actives.indexOf(t),1),this.idles.indexOf(t)>=0&&this.idles.splice(this.idles.indexOf(t),1),this.ids.indexOf(t.identifier)>=0&&this.ids.splice(this.ids.indexOf(t.identifier),1),this.manager.removeIdentifier(t.identifier),this.manager.unbindDocument()},R.prototype.destroy=function(){for(var e in this.unbindEvt(this.options.zone,"start"),this.nipples.forEach(function(e){e.destroy()}),this.pressureIntervals)this.pressureIntervals.hasOwnProperty(e)&&clearInterval(this.pressureIntervals[e]);this.trigger("destroyed",this.nipples),this.manager.unbindDocument(),this.off()};var N=R;function M(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=h(),t.config(e),t.prepareCollections();var i=function(){var e;t.collections.forEach(function(i){i.forEach(function(i){e=i.el.getBoundingClientRect(),i.position={x:t.scroll.x+e.left,y:t.scroll.y+e.top}})})};c(window,"resize",function(){s(i)});var n=function(){t.scroll=h()};return c(window,"scroll",function(){s(n)}),t.collections}M.prototype=new T,M.constructor=M,M.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(e){return!(i=e.get(t))}),i}},M.prototype.create=function(e){return this.createCollection(e)},M.prototype.createCollection=function(e){var t=new N(this,e);return this.bindCollection(t),this.collections.push(t),t},M.prototype.bindCollection=function(e){var t,i=this,n=function(e,n){t=e.type+" "+n.id+":"+e.type,i.trigger(t,n)};e.on("destroyed",i.onDestroyed.bind(i)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)},M.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,"move").bindEvt(document,"end"),this.binded=!0)},M.prototype.unbindDocument=function(e){Object.keys(this.ids).length&&!0!==e||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.binded=!1)},M.prototype.getIdentifier=function(e){var t;return e?void 0===(t=void 0===e.identifier?e.pointerId:e.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},M.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t},M.prototype.onmove=function(e){return this.onAny("move",e),!1},M.prototype.onend=function(e){return this.onAny("end",e),!1},M.prototype.oncancel=function(e){return this.onAny("end",e),!1},M.prototype.onAny=function(e,t){var i,n=this,o="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=d(t);return v(t,function(e){i=n.getIdentifier(e),v(n.collections,function(e,t,i){i.ids.indexOf(t)>=0&&(i[o](e),e._found_=!0)}.bind(null,e,i)),e._found_||n.removeIdentifier(i)}),!1},M.prototype.destroy=function(){this.unbindDocument(!0),this.ids={},this.index=0,this.collections.forEach(function(e){e.destroy()}),this.off()},M.prototype.onDestroyed=function(e,t){if(this.collections.indexOf(t)<0)return!1;this.collections.splice(this.collections.indexOf(t),1)};var C=new M;t.default={create:function(e){return C.create(e)},factory:C}}]).default},"object"==typeof i&&"object"==typeof t?t.exports=o():"function"==typeof define&&define.amd?define("nipplejs",[],o):"object"==typeof i?i.nipplejs=o():n.nipplejs=o()},{}],10:[function(e,t,i){var n=e("three");function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function a(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return r(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,c=function(){function e(){}return e.roundNumber=function(e,t){var i=Math.pow(10,t);return Math.round(e*i)/i},e.sample=function(e){return e[Math.floor(Math.random()*e.length)]},e.distanceToSquared=function(e,t){var i=e.x-t.x,n=e.y-t.y,o=e.z-t.z;return i*i+n*n+o*o},e.isPointInPoly=function(e,t){for(var i=!1,n=-1,o=e.length,r=o-1;++n<o;r=n)(e[n].z<=t.z&&t.z<e[r].z||e[r].z<=t.z&&t.z<e[n].z)&&t.x<(e[r].x-e[n].x)*(t.z-e[n].z)/(e[r].z-e[n].z)+e[n].x&&(i=!i);return i},e.isVectorInPolygon=function(e,t,i){var n=1e5,o=-1e5,r=[];return t.vertexIds.forEach(function(e){n=Math.min(i[e].y,n),o=Math.max(i[e].y,o),r.push(i[e])}),!!(e.y<o+.5&&e.y>n-.5&&this.isPointInPoly(r,e))},e.triarea2=function(e,t,i){return(i.x-e.x)*(t.z-e.z)-(t.x-e.x)*(i.z-e.z)},e.vequal=function(e,t){return this.distanceToSquared(e,t)<1e-5},e.mergeVertices=function(e,t){void 0===t&&(t=1e-4),t=Math.max(t,Number.EPSILON);for(var i={},o=e.getIndex(),r=e.getAttribute("position"),a=o?o.count:r.count,s=0,c=[],l=[],d=Math.log10(1/t),h=Math.pow(10,d),u=0;u<a;u++){var p=o?o.getX(u):u,f="";f+=~~(r.getX(p)*h)+",",f+=~~(r.getY(p)*h)+",",(f+=~~(r.getZ(p)*h)+",")in i?c.push(i[f]):(l.push(r.getX(p)),l.push(r.getY(p)),l.push(r.getZ(p)),i[f]=s,c.push(s),s++)}var m=new n.BufferAttribute(new Float32Array(l),r.itemSize,r.normalized),v=new n.BufferGeometry;return v.setAttribute("position",m),v.setIndex(c),v},e}(),l=function(){function e(e){this.content=[],this.scoreFunction=e}var t=e.prototype;return t.push=function(e){this.content.push(e),this.sinkDown(this.content.length-1)},t.pop=function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e},t.remove=function(e){var t=this.content.indexOf(e),i=this.content.pop();t!==this.content.length-1&&(this.content[t]=i,this.scoreFunction(i)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},t.size=function(){return this.content.length},t.rescoreElement=function(e){this.sinkDown(this.content.indexOf(e))},t.sinkDown=function(e){for(var t=this.content[e];e>0;){var i=(e+1>>1)-1,n=this.content[i];if(!(this.scoreFunction(t)<this.scoreFunction(n)))break;this.content[i]=t,this.content[e]=n,e=i}},t.bubbleUp=function(e){for(var t=this.content.length,i=this.content[e],n=this.scoreFunction(i);;){var o=e+1<<1,r=o-1,a=null,s=void 0;if(r<t&&(s=this.scoreFunction(this.content[r]))<n&&(a=r),o<t&&this.scoreFunction(this.content[o])<(null===a?n:s)&&(a=o),null===a)break;this.content[e]=this.content[a],this.content[a]=i,e=a}},e}(),d=function(){function e(){}return e.init=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.f=0,i.g=0,i.h=0,i.cost=1,i.visited=!1,i.closed=!1,i.parent=null}},e.cleanUp=function(e){for(var t=0;t<e.length;t++){var i=e[t];delete i.f,delete i.g,delete i.h,delete i.cost,delete i.visited,delete i.closed,delete i.parent}},e.heap=function(){return new l(function(e){return e.f})},e.search=function(e,t,i){this.init(e);var n=this.heap();for(n.push(t);n.size()>0;){var o=n.pop();if(o===i){for(var r=o,a=[];r.parent;)a.push(r),r=r.parent;return this.cleanUp(a),a.reverse()}o.closed=!0;for(var s=this.neighbours(e,o),c=0,l=s.length;c<l;c++){var d=s[c];if(!d.closed){var h=o.g+d.cost,u=d.visited;if(!u||h<d.g){if(d.visited=!0,d.parent=o,!d.centroid||!i.centroid)throw new Error("Unexpected state");d.h=d.h||this.heuristic(d.centroid,i.centroid),d.g=h,d.f=d.g+d.h,u?n.rescoreElement(d):n.push(d)}}}}return[]},e.heuristic=function(e,t){return c.distanceToSquared(e,t)},e.neighbours=function(e,t){for(var i=[],n=0;n<t.neighbours.length;n++)i.push(e[t.neighbours[n]]);return i},e}(),h=function(){function e(){}return e.buildZone=function(e,t){var i=this,o=this._buildNavigationMesh(e,t),r={};o.vertices.forEach(function(e){e.x=c.roundNumber(e.x,2),e.y=c.roundNumber(e.y,2),e.z=c.roundNumber(e.z,2)}),r.vertices=o.vertices;var a=this._buildPolygonGroups(o);return r.groups=new Array(a.length),a.forEach(function(e,t){var o=new Map;e.forEach(function(e,t){o.set(e,t)});var a=new Array(e.length);e.forEach(function(e,t){var s=[];e.neighbours.forEach(function(e){return s.push(o.get(e))});var l=[];e.neighbours.forEach(function(t){return l.push(i._getSharedVerticesInOrder(e,t))});var d=new n.Vector3(0,0,0);d.add(r.vertices[e.vertexIds[0]]),d.add(r.vertices[e.vertexIds[1]]),d.add(r.vertices[e.vertexIds[2]]),d.divideScalar(3),d.x=c.roundNumber(d.x,2),d.y=c.roundNumber(d.y,2),d.z=c.roundNumber(d.z,2),a[t]={id:t,neighbours:s,vertexIds:e.vertexIds,centroid:d,portals:l}}),r.groups[t]=a}),r},e._buildNavigationMesh=function(e,t){return e=c.mergeVertices(e,t),this._buildPolygonsFromGeometry(e)},e._spreadGroupId=function(e){for(var t=new Set([e]);t.size>0;){var i=t;t=new Set,i.forEach(function(i){i.group=e.group,i.neighbours.forEach(function(e){void 0===e.group&&t.add(e)})})}},e._buildPolygonGroups=function(e){var t=this,i=[];return e.polygons.forEach(function(e){void 0!==e.group?i[e.group].push(e):(e.group=i.length,t._spreadGroupId(e),i.push([e]))}),i},e._buildPolygonNeighbours=function(e,t){var i=new Set,n=t[e.vertexIds[1]],o=t[e.vertexIds[2]];return t[e.vertexIds[0]].forEach(function(t){t!==e&&(n.includes(t)||o.includes(t))&&i.add(t)}),n.forEach(function(t){t!==e&&o.includes(t)&&i.add(t)}),i},e._buildPolygonsFromGeometry=function(e){for(var t=this,i=[],o=[],r=e.attributes.position,a=e.index,s=[],c=0;c<r.count;c++)o.push((new n.Vector3).fromBufferAttribute(r,c)),s[c]=[];for(var l=0;l<e.index.count;l+=3){var d=a.getX(l),h=a.getX(l+1),u=a.getX(l+2),p={vertexIds:[d,h,u],neighbours:null};i.push(p),s[d].push(p),s[h].push(p),s[u].push(p)}return i.forEach(function(e){e.neighbours=t._buildPolygonNeighbours(e,s)}),{polygons:i,vertices:o}},e._getSharedVerticesInOrder=function(e,t){var i=e.vertexIds,n=i[0],o=i[1],r=i[2],a=t.vertexIds,s=a.includes(n),c=a.includes(o),l=a.includes(r);return s&&c&&l?Array.from(i):s&&c?[n,o]:c&&l?[o,r]:s&&l?[r,n]:(console.warn("Error processing navigation mesh neighbors; neighbors with <2 shared vertices found."),[])},e}(),u=function(){function e(){this.portals=[]}var t=e.prototype;return t.push=function(e,t){void 0===t&&(t=e),this.portals.push({left:e,right:t})},t.stringPull=function(){var e,t,i,n=this.portals,o=[],r=0,a=0,s=0;t=n[0].left,i=n[0].right,o.push(e=n[0].left);for(var l=1;l<n.length;l++){var d=n[l].left,h=n[l].right;if(c.triarea2(e,i,h)<=0){if(!(c.vequal(e,i)||c.triarea2(e,t,h)>0)){o.push(t),t=e=t,i=e,a=r=a,s=r,l=r;continue}i=h,s=l}if(c.triarea2(e,t,d)>=0){if(!(c.vequal(e,t)||c.triarea2(e,i,d)<0)){o.push(i),t=e=i,i=e,a=r=s,s=r,l=r;continue}t=d,a=l}}return 0!==o.length&&c.vequal(o[o.length-1],n[n.length-1].left)||o.push(n[n.length-1].left),this.path=o,o},e}(),p=function(){function e(){this.zones={}}e.createZone=function(e,t){return void 0===t&&(t=1e-4),h.buildZone(e,t)};var t=e.prototype;return t.setZoneData=function(e,t){this.zones[e]=t},t.getRandomNode=function(e,t,i,o){if(!this.zones[e])return new n.Vector3;i=i||null,o=o||0;var r=[];return this.zones[e].groups[t].forEach(function(e){i&&o?c.distanceToSquared(i,e.centroid)<o*o&&r.push(e.centroid):r.push(e.centroid)}),c.sample(r)||new n.Vector3},t.getClosestNode=function(e,t,i,n){void 0===n&&(n=!1);var o=this.zones[t].vertices,r=null,a=1/0;return this.zones[t].groups[i].forEach(function(t){var i=c.distanceToSquared(t.centroid,e);i<a&&(!n||c.isVectorInPolygon(e,t,o))&&(r=t,a=i)}),r},t.findPath=function(e,t,i,o){var r=this.zones[i].groups[o],a=this.zones[i].vertices,s=this.getClosestNode(e,i,o,!1),c=this.getClosestNode(t,i,o,!0);if(!s||!c)return null;var l=d.search(r,s,c),h=function(e,t){for(var i=0;i<e.neighbours.length;i++)if(e.neighbours[i]===t.id)return e.portals[i]},p=new u;p.push(e);for(var f=0;f<l.length;f++){var m=l[f+1];if(m){var v=h(l[f],m);p.push(a[v[0]],a[v[1]])}}p.push(t),p.stringPull();var y=p.path.map(function(e){return new n.Vector3(e.x,e.y,e.z)});return y.shift(),y},e}();p.prototype.getGroup=(s=new n.Plane,function(e,t,i){if(void 0===i&&(i=!1),!this.zones[e])return null;for(var n=null,o=Math.pow(50,2),r=this.zones[e],l=0;l<r.groups.length;l++)for(var d,h=a(r.groups[l]);!(d=h()).done;){var u=d.value;if(i&&(s.setFromCoplanarPoints(r.vertices[u.vertexIds[0]],r.vertices[u.vertexIds[1]],r.vertices[u.vertexIds[2]]),Math.abs(s.distanceToPoint(t))<.01&&c.isPointInPoly([r.vertices[u.vertexIds[0]],r.vertices[u.vertexIds[1]],r.vertices[u.vertexIds[2]]],t)))return l;var p=c.distanceToSquared(u.centroid,t);p<o&&(n=l,o=p)}return n}),p.prototype.clampStep=function(){var e,t,i=new n.Vector3,o=new n.Plane,r=new n.Triangle,a=new n.Vector3,s=new n.Vector3;return function(n,c,l,d,h,u){var p=this.zones[d].vertices,f=this.zones[d].groups[h],m=[l],v={};v[l.id]=0,e=void 0,s.set(0,0,0),t=1/0,o.setFromCoplanarPoints(p[l.vertexIds[0]],p[l.vertexIds[1]],p[l.vertexIds[2]]),o.projectPoint(c,i),a.copy(i);for(var y=m.pop();y;y=m.pop()){r.set(p[y.vertexIds[0]],p[y.vertexIds[1]],p[y.vertexIds[2]]),r.closestPointToPoint(a,i),i.distanceToSquared(a)<t&&(e=y,s.copy(i),t=i.distanceToSquared(a));var g=v[y.id];if(!(g>2))for(var E=0;E<y.neighbours.length;E++){var b=f[y.neighbours[E]];b.id in v||(m.push(b),v[b.id]=g+1)}}return u.copy(s),e}}();var f={PLAYER:new n.Color(15631215).convertGammaToLinear(2.2).getHex(),TARGET:new n.Color(14469912).convertGammaToLinear(2.2).getHex(),PATH:new n.Color(41903).convertGammaToLinear(2.2).getHex(),WAYPOINT:new n.Color(41903).convertGammaToLinear(2.2).getHex(),CLAMPED_STEP:new n.Color(14472114).convertGammaToLinear(2.2).getHex(),CLOSEST_NODE:new n.Color(4417387).convertGammaToLinear(2.2).getHex()},m=function(e){var t,i;function r(){var t;return(t=e.call(this)||this)._playerMarker=new n.Mesh(new n.SphereBufferGeometry(.25,32,32),new n.MeshBasicMaterial({color:f.PLAYER})),t._targetMarker=new n.Mesh(new n.BoxBufferGeometry(.3,.3,.3),new n.MeshBasicMaterial({color:f.TARGET})),t._nodeMarker=new n.Mesh(new n.BoxBufferGeometry(.1,.8,.1),new n.MeshBasicMaterial({color:f.CLOSEST_NODE})),t._stepMarker=new n.Mesh(new n.BoxBufferGeometry(.1,1,.1),new n.MeshBasicMaterial({color:f.CLAMPED_STEP})),t._pathMarker=new n.Object3D,t._pathLineMaterial=new n.LineBasicMaterial({color:f.PATH,linewidth:2}),t._pathPointMaterial=new n.MeshBasicMaterial({color:f.WAYPOINT}),t._pathPointGeometry=new n.SphereBufferGeometry(.08),t._markers=[t._playerMarker,t._targetMarker,t._nodeMarker,t._stepMarker,t._pathMarker],t._markers.forEach(function(e){e.visible=!1,t.add(e)}),t}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,o(t,i);var a=r.prototype;return a.setPath=function(e){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);e=[this._playerMarker.position].concat(e);var t=new n.BufferGeometry;t.setAttribute("position",new n.BufferAttribute(new Float32Array(3*e.length),3));for(var i=0;i<e.length;i++)t.attributes.position.setXYZ(i,e[i].x,e[i].y+.2,e[i].z);this._pathMarker.add(new n.Line(t,this._pathLineMaterial));for(var o=0;o<e.length-1;o++){var r=new n.Mesh(this._pathPointGeometry,this._pathPointMaterial);r.position.copy(e[o]),r.position.y+=.2,this._pathMarker.add(r)}return this._pathMarker.visible=!0,this},a.setPlayerPosition=function(e){return this._playerMarker.position.copy(e),this._playerMarker.visible=!0,this},a.setTargetPosition=function(e){return this._targetMarker.position.copy(e),this._targetMarker.visible=!0,this},a.setNodePosition=function(e){return this._nodeMarker.position.copy(e),this._nodeMarker.visible=!0,this},a.setStepPosition=function(e){return this._stepMarker.position.copy(e),this._stepMarker.visible=!0,this},a.reset=function(){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);return this._markers.forEach(function(e){e.visible=!1}),this},r}(n.Object3D);i.Pathfinding=p,i.PathfindingHelper=m},{three:"three"}],11:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("checkpoint-controls",{schema:{enabled:{default:!0},mode:{default:"teleport",oneOf:["teleport","animate"]},animateSpeed:{default:3}},init:function(){this.active=!0,this.checkpoint=null,this.isNavMeshConstrained=!1,this.offset=new THREE.Vector3,this.position=new THREE.Vector3,this.targetPosition=new THREE.Vector3},play:function(){this.active=!0},pause:function(){this.active=!1},setCheckpoint:function(e){var t=this.el;this.active&&this.checkpoint!==e&&(this.checkpoint&&t.emit("navigation-end",{checkpoint:this.checkpoint}),this.checkpoint=e,this.sync(),this.position.distanceTo(this.targetPosition)<.1?this.checkpoint=null:(t.emit("navigation-start",{checkpoint:e}),"teleport"===this.data.mode&&(this.el.setAttribute("position",this.targetPosition),this.checkpoint=null,t.emit("navigation-end",{checkpoint:e}),t.components["movement-controls"].updateNavLocation())))},isVelocityActive:function(){return!(!this.active||!this.checkpoint)},getVelocity:function(){if(this.active){var e=this.data,t=this.offset,i=this.position,n=this.targetPosition,o=this.checkpoint;return this.sync(),i.distanceTo(n)<.1?(this.checkpoint=null,this.el.emit("navigation-end",{checkpoint:o}),t.set(0,0,0)):(t.setLength(e.animateSpeed),t)}},sync:function(){var e=this.offset,t=this.position,i=this.targetPosition;t.copy(this.el.getAttribute("position")),this.checkpoint.object3D.getWorldPosition(i),i.add(this.checkpoint.components.checkpoint.getOffset()),e.copy(i).sub(t)}})},{}],12:[function(e,t,i){"use strict";var n,o,r=e("../../lib/GamepadButton"),a=e("../../lib/GamepadButtonEvent"),s="left",c="right",l=1,d=2;t.exports=AFRAME.registerComponent("gamepad-controls",{GamepadButton:r,schema:{enabled:{default:!0},rotationSensitivity:{default:2}},init:function(){var e=this.el.sceneEl;this.system=e.systems["tracked-controls-webxr"]||{controllers:[]},this.prevTime=window.performance.now(),this.buttons={};var t=this.el.object3D.rotation;this.pitch=new THREE.Object3D,this.pitch.rotation.x=t.x,this.yaw=new THREE.Object3D,this.yaw.position.y=10,this.yaw.rotation.y=t.y,this.yaw.add(this.pitch),this._lookVector=new THREE.Vector2,this._moveVector=new THREE.Vector2,this._dpadVector=new THREE.Vector2,e.addBehavior(this)},update:function(){this.tick()},tick:function(e,t){this.updateButtonState(),this.updateRotation(t)},remove:function(){},isVelocityActive:function(){if(!this.data.enabled||!this.isConnected())return!1;var e=this._dpadVector,t=this._moveVector;this.getDpad(e),this.getJoystick(l,t);var i=e.x||t.x,n=e.y||t.y;return Math.abs(i)>.2||Math.abs(n)>.2},getVelocityDelta:function(){var e=this._dpadVector,t=this._moveVector;this.getDpad(e),this.getJoystick(l,t);var i=e.x||t.x,n=e.y||t.y,o=new THREE.Vector3;return Math.abs(i)>.2&&(o.x+=i),Math.abs(n)>.2&&(o.z+=n),o},isRotationActive:function(){if(!this.data.enabled||!this.isConnected())return!1;var e=this._lookVector;return this.getJoystick(d,e),Math.abs(e.x)>.2||Math.abs(e.y)>.2},updateRotation:function(e){if(this.isRotationActive()){var t=this.data,i=this.yaw,n=this.pitch;i.rotation.y=this.el.object3D.rotation.y,n.rotation.x=this.el.object3D.rotation.x;var o=this._lookVector;this.getJoystick(d,o),Math.abs(o.x)<=.2&&(o.x=0),Math.abs(o.y)<=.2&&(o.y=0),o.multiplyScalar(t.rotationSensitivity*e/1e3),i.rotation.y-=o.x,n.rotation.x-=o.y,n.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,n.rotation.x)),this.el.object3D.rotation.set(n.rotation.x,i.rotation.y,0)}},updateButtonState:function(){var e=this.getGamepad(c);if(this.data.enabled&&e)for(var t=0;t<e.buttons.length;t++)e.buttons[t].pressed&&!this.buttons[t]?this.emit(new a("gamepadbuttondown",t,e.buttons[t])):!e.buttons[t].pressed&&this.buttons[t]&&this.emit(new a("gamepadbuttonup",t,e.buttons[t])),this.buttons[t]=e.buttons[t].pressed;else Object.keys(this.buttons)&&(this.buttons={})},emit:function(e){this.el.emit(e.type,e),this.el.emit(e.type+":"+e.index,new a(e.type,e.index,e))},getGamepad:(n=[],o=[],function(e){var t=this.el.sceneEl.components["proxy-controls"],i=t&&t.isConnected()&&t.getGamepad(0);if(i)return i;n.length=0;for(var r=0;r<this.system.controllers.length;r++){var a=this.system.controllers[r],s=a?a.gamepad:null;if(n.push(s),s&&a.handedness===e)return s}for(var c=navigator.getGamepads?navigator.getGamepads():o,l=0;l<c.length;l++){var d=c[l];if(d&&d.hand===e)return d}return n[0]||c[0]}),getButton:function(e){return this.getGamepad(c).buttons[e]},getAxis:function(e){return this.getGamepad(e>1?c:s).axes[e]},getJoystick:function(e,t){var i=this.getGamepad(e===l?s:c);if(!i)return t.set(0,0);if("xr-standard"===i.mapping)switch(e){case l:return t.set(i.axes[2],i.axes[3]);case d:return t.set(i.axes[2],0)}else switch(e){case l:return t.set(i.axes[0],i.axes[1]);case d:return t.set(i.axes[2],i.axes[3])}throw new Error('Unexpected joystick index "%d".',e)},getDpad:function(e){var t=this.getGamepad(s);return t&&t.buttons[r.DPAD_RIGHT]?e.set((t.buttons[r.DPAD_RIGHT].pressed?1:0)+(t.buttons[r.DPAD_LEFT].pressed?-1:0),(t.buttons[r.DPAD_UP].pressed?-1:0)+(t.buttons[r.DPAD_DOWN].pressed?1:0)):e.set(0,0)},isConnected:function(){var e=this.getGamepad(s);return!(!e||!e.connected)},getID:function(){return this.getGamepad(s).id}})},{"../../lib/GamepadButton":5,"../../lib/GamepadButtonEvent":6}],13:[function(e,t,i){"use strict";e("./checkpoint-controls"),e("./gamepad-controls"),e("./keyboard-controls"),e("./touch-controls"),e("./movement-controls"),e("./trackpad-controls"),e("./nipple-controls")},{"./checkpoint-controls":11,"./gamepad-controls":12,"./keyboard-controls":14,"./movement-controls":15,"./nipple-controls":16,"./touch-controls":17,"./trackpad-controls":18}],14:[function(e,t,i){"use strict";e("../../lib/keyboard.polyfill");var n=window.KeyboardEvent;t.exports=AFRAME.registerComponent("keyboard-controls",{schema:{enabled:{default:!0},debug:{default:!1}},init:function(){this.dVelocity=new THREE.Vector3,this.localKeys={},this.listeners={keydown:this.onKeyDown.bind(this),keyup:this.onKeyUp.bind(this),blur:this.onBlur.bind(this),onContextMenu:this.onContextMenu.bind(this)}},isVelocityActive:function(){return this.data.enabled&&!!Object.keys(this.getKeys()).length},getVelocityDelta:function(){var e=this.data,t=this.getKeys();return this.dVelocity.set(0,0,0),e.enabled&&((t.KeyW||t.ArrowUp)&&(this.dVelocity.z-=1),(t.KeyA||t.ArrowLeft)&&(this.dVelocity.x-=1),(t.KeyS||t.ArrowDown)&&(this.dVelocity.z+=1),(t.KeyD||t.ArrowRight)&&(this.dVelocity.x+=1)),this.dVelocity.clone()},play:function(){this.attachEventListeners()},pause:function(){this.removeEventListeners()},attachEventListeners:function(){window.addEventListener("contextmenu",this.listeners.onContextMenu,!1),window.addEventListener("keydown",this.listeners.keydown,!1),window.addEventListener("keyup",this.listeners.keyup,!1),window.addEventListener("blur",this.listeners.blur,!1)},onContextMenu:function(){for(var e in this.localKeys)this.localKeys.hasOwnProperty(e)&&delete this.localKeys[e]},removeEventListeners:function(){window.removeEventListener("keydown",this.listeners.keydown),window.removeEventListener("keyup",this.listeners.keyup),window.removeEventListener("blur",this.listeners.blur)},onKeyDown:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(this.localKeys[e.code]=!0,this.emit(e))},onKeyUp:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(delete this.localKeys[e.code],this.emit(e))},onBlur:function(){for(var e in this.localKeys)this.localKeys.hasOwnProperty(e)&&delete this.localKeys[e]},emit:function(e){"__keyboard-controls-proxy"in e&&this.el.emit(e.type,e),this.el.emit(e.type+":"+e.code,new n(e.type,e)),this.data.debug&&console.log(e.type+":"+e.code)},isPressed:function(e){return e in this.getKeys()},getKeys:function(){return this.isProxied()?this.el.sceneEl.components["proxy-controls"].getKeyboard():this.localKeys},isProxied:function(){var e=this.el.sceneEl.components["proxy-controls"];return e&&e.isConnected()}})},{"../../lib/keyboard.polyfill":8}],15:[function(e,t,i){"use strict";var n,o,r,a,s;t.exports=AFRAME.registerComponent("movement-controls",{dependencies:["rotation"],schema:{enabled:{default:!0},controls:{default:["gamepad","trackpad","keyboard","touch"]},speed:{default:.3,min:0},fly:{default:!1},constrainToNavMesh:{default:!1},camera:{default:"[movement-controls] [camera]",type:"selector"}},init:function(){var e=this.el;this.data.camera||(this.data.camera=e.querySelector("[camera]")),this.velocityCtrl=null,this.velocity=new THREE.Vector3,this.heading=new THREE.Quaternion,this.navGroup=null,this.navNode=null,e.sceneEl.hasLoaded?this.injectControls():e.sceneEl.addEventListener("loaded",this.injectControls.bind(this))},update:function(e){var t=this.el,i=this.data,n=t.sceneEl.systems.nav;if(t.sceneEl.hasLoaded&&this.injectControls(),n&&i.constrainToNavMesh!==e.constrainToNavMesh&&(i.constrainToNavMesh?n.addAgent(this):n.removeAgent(this)),i.enabled!==e.enabled)for(var o=0;o<i.controls.length;o++){var r=i.controls[o]+"-controls";this.el.setAttribute(r,{enabled:this.data.enabled})}},injectControls:function(){for(var e=this.data,t=0;t<e.controls.length;t++){var i=e.controls[t]+"-controls";this.el.setAttribute(i,{enabled:this.data.enabled})}},updateNavLocation:function(){this.navGroup=null,this.navNode=null},tick:(r=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Vector3,function(e,t){if(t){var i=this.el,n=this.data;if(n.enabled){this.updateVelocityCtrl();var o=this.velocityCtrl,c=this.velocity;if(o)if(t/1e3>.2?c.set(0,0,0):this.updateVelocity(t),n.constrainToNavMesh&&!1!==o.isNavMeshConstrained){if(c.lengthSq()<1e-5)return void(this.navNode=null);r.copy(i.object3D.position),a.copy(c).multiplyScalar(t/1e3).add(r);var l=i.sceneEl.systems.nav;this.navGroup=null===this.navGroup?l.getGroup(r):this.navGroup,null==this.navGroup||this.navNode||(this.navNode=l.getNode(r,this.navGroup)),this.navNode&&(this.navNode=l.clampStep(r,a,this.navGroup,this.navNode,s),i.object3D.position.copy(s))}else i.hasAttribute("velocity")?i.setAttribute("velocity",c):(i.object3D.position.x+=c.x*t/1e3,i.object3D.position.y+=c.y*t/1e3,i.object3D.position.z+=c.z*t/1e3)}}}),updateVelocityCtrl:function(){var e=this.data;if(e.enabled){for(var t=0,i=e.controls.length;t<i;t++){var n=this.el.components[e.controls[t]+"-controls"];if(n&&n.isVelocityActive())return void(this.velocityCtrl=n)}this.velocityCtrl=null}},updateVelocity:(n=new THREE.Vector2,o=new THREE.Quaternion,function(e){var t=void 0,i=this.el,r=this.velocityCtrl,a=this.velocity,s=this.data;if(r){if(!r.getVelocityDelta){if(r.getVelocity)return void a.copy(r.getVelocity());if(r.getPositionDelta)return void a.copy(r.getPositionDelta(e).multiplyScalar(1e3/e));throw new Error("Incompatible movement controls: ",r)}t=r.getVelocityDelta(e)}if(i.hasAttribute("velocity")&&!s.constrainToNavMesh&&a.copy(this.el.getAttribute("velocity")),t&&s.enabled){var c=s.camera;o.copy(c.object3D.quaternion),o.premultiply(i.object3D.quaternion),t.applyQuaternion(o);var l=t.length();s.fly?(a.copy(t),a.multiplyScalar(16.66667*this.data.speed)):(n.set(t.x,t.z),n.setLength(l*this.data.speed*16.66667),a.x=n.x,a.y=0,a.z=n.y)}})})},{}],16:[function(e,t,i){"use strict";var n,o=e("nipplejs"),r=(n=o)&&n.__esModule?n:{default:n};AFRAME.registerComponent("nipple-controls",{schema:{enabled:{default:!0},mode:{default:"dynamic",oneOf:["static","semi","dynamic"]},rotationSensitivity:{default:1},moveJoystickEnabled:{default:!0},lookJoystickEnabled:{default:!0},sideMargin:{default:"30px"},bottomMargin:{default:"70px"},moveJoystickPosition:{default:"left",oneOf:["left","right"]},lookJoystickPosition:{default:"right",oneOf:["left","right"]}},init:function(){this.dVelocity=new THREE.Vector3,this.lookVector=new THREE.Vector2;var e=this.el.querySelector("[look-controls]").components["look-controls"];this.pitchObject=e.pitchObject,this.yawObject=e.yawObject,this.rigRotation=this.el.object3D.rotation,this.moveData=void 0,this.lookData=void 0,this.moving=!1,this.rotating=!1},update:function(e){this.data.moveJoystickPosition===e.moveJoystickPosition&&this.data.sideMargin===e.sideMargin&&this.data.bottomMargin===e.bottomMargin&&this.data.mode===e.mode||this.removeMoveJoystick(),this.data.lookJoystickPosition===e.lookJoystickPosition&&this.data.sideMargin===e.sideMargin&&this.data.bottomMargin===e.bottomMargin&&this.data.mode===e.mode||this.removeLookJoystick(),this.data.enabled&&this.data.moveJoystickEnabled?this.createMoveJoystick():this.removeMoveJoystick(),this.data.enabled&&this.data.lookJoystickEnabled?this.createLookJoystick():this.removeLookJoystick()},pause:function(){this.moving=!1,this.rotating=!1},remove:function(){this.removeMoveJoystick(),this.removeLookJoystick()},isVelocityActive:function(){return this.data.enabled&&this.moving},getVelocityDelta:function(){if(this.dVelocity.set(0,0,0),this.isVelocityActive()){var e=this.moveData.force<1?this.moveData.force:1,t=this.moveData.angle.radian,i=Math.cos(t)*e,n=-Math.sin(t)*e;this.dVelocity.set(i,0,n)}return this.dVelocity},isRotationActive:function(){return this.data.enabled&&this.rotating},updateRotation:function(e){if(this.isRotationActive()){var t=this.lookData.force<1?this.lookData.force:1,i=this.lookData.angle.radian,n=this.lookVector;n.x=Math.cos(i)*t,n.y=Math.sin(i)*t,n.multiplyScalar(this.data.rotationSensitivity*e/1e3),this.yawObject.rotation.y-=n.x;var o=this.pitchObject.rotation.x+n.y;o=Math.max(-Math.PI/2,Math.min(Math.PI/2,o)),this.pitchObject.rotation.x=o}},tick:function(e,t){this.updateRotation(t)},initLeftZone:function(){var e=document.createElement("div");e.setAttribute("id","joystickLeftZone"),e.setAttribute("style","position:absolute;"+this.data.moveJoystickPosition+":"+this.data.sideMargin+";bottom:"+this.data.bottomMargin+";z-index:1"),document.body.appendChild(e),this.leftZone=e},initRightZone:function(){var e=document.createElement("div");e.setAttribute("id","joystickRightZone"),e.setAttribute("style","position:absolute;"+this.data.lookJoystickPosition+":"+this.data.sideMargin+";bottom:"+this.data.bottomMargin+";z-index:1"),document.body.appendChild(e),this.rightZone=e},createMoveJoystick:function(){var e=this;if(!this.moveJoystick){this.initLeftZone();var t={mode:this.data.mode,zone:this.leftZone,color:"white",fadeTime:0};this.leftZone.style.width="100px","static"===this.data.mode?(this.leftZone.style.height="100px",t.position={left:"50%",bottom:"50%"}):this.leftZone.style.height="400px",this.moveJoystick=r.default.create(t),this.moveJoystick.on("move",function(t,i){e.moveData=i,e.moving=!0}),this.moveJoystick.on("end",function(t,i){e.moving=!1})}},createLookJoystick:function(){var e=this;if(!this.lookJoystick){this.initRightZone();var t={mode:this.data.mode,zone:this.rightZone,color:"white",fadeTime:0};this.rightZone.style.width="100px","static"===this.data.mode?(this.rightZone.style.height="100px",t.position={left:"50%",bottom:"50%"}):this.rightZone.style.height="400px",this.lookJoystick=r.default.create(t),this.lookJoystick.on("move",function(t,i){e.lookData=i,e.rotating=!0}),this.lookJoystick.on("end",function(t,i){e.rotating=!1})}},removeMoveJoystick:function(){this.moveJoystick&&(this.moveJoystick.destroy(),this.moveJoystick=void 0),this.moveData=void 0,this.leftZone&&this.leftZone.parentNode&&(this.leftZone.remove(),this.leftZone=void 0)},removeLookJoystick:function(){this.lookJoystick&&(this.lookJoystick.destroy(),this.lookJoystick=void 0),this.lookData=void 0,this.rightZone&&this.rightZone.parentNode&&(this.rightZone.remove(),this.rightZone=void 0)}})},{nipplejs:9}],17:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},reverseEnabled:{default:!0}},init:function(){this.dVelocity=new THREE.Vector3,this.bindMethods(),this.direction=0},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){var e=this.el.sceneEl,t=e.canvas;if(t){t.addEventListener("touchstart",this.onTouchStart),t.addEventListener("touchend",this.onTouchEnd);var i=e.getAttribute("vr-mode-ui");i&&i.cardboardModeEnabled&&e.addEventListener("enter-vr",this.onEnterVR)}else e.addEventListener("render-target-loaded",this.addEventListeners.bind(this))},removeEventListeners:function(){var e=this.el.sceneEl&&this.el.sceneEl.canvas;e&&(e.removeEventListener("touchstart",this.onTouchStart),e.removeEventListener("touchend",this.onTouchEnd),this.el.sceneEl.removeEventListener("enter-vr",this.onEnterVR))},isVelocityActive:function(){return this.data.enabled&&!!this.direction},getVelocityDelta:function(){return this.dVelocity.z=this.direction,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onEnterVR=this.onEnterVR.bind(this)},onTouchStart:function(e){this.direction=-1,this.data.reverseEnabled&&e.touches&&2===e.touches.length&&(this.direction=1),e.preventDefault()},onTouchEnd:function(e){this.direction=0,e.preventDefault()},onEnterVR:function(){var e=this.el.sceneEl.xrSession;e&&(e.addEventListener("selectstart",this.onTouchStart),e.addEventListener("selectend",this.onTouchEnd))}})},{}],18:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("trackpad-controls",{schema:{enabled:{default:!0},enableNegX:{default:!0},enablePosX:{default:!0},enableNegZ:{default:!0},enablePosZ:{default:!0},mode:{default:"touch",oneOf:["swipe","touch","press"]}},init:function(){this.dVelocity=new THREE.Vector3,this.zVel=0,this.xVel=0,this.bindMethods()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){var e=this.data,t=this.el.sceneEl;switch(t.addEventListener("axismove",this.onAxisMove),e.mode){case"swipe":case"touch":t.addEventListener("trackpadtouchstart",this.onTouchStart),t.addEventListener("trackpadtouchend",this.onTouchEnd);break;case"press":t.addEventListener("trackpaddown",this.onTouchStart),t.addEventListener("trackpadup",this.onTouchEnd)}},removeEventListeners:function(){var e=this.el.sceneEl;e.removeEventListener("axismove",this.onAxisMove),e.removeEventListener("trackpadtouchstart",this.onTouchStart),e.removeEventListener("trackpadtouchend",this.onTouchEnd),e.removeEventListener("trackpaddown",this.onTouchStart),e.removeEventListener("trackpadup",this.onTouchEnd)},isVelocityActive:function(){return this.data.enabled&&this.isMoving},getVelocityDelta:function(){return this.dVelocity.z=this.isMoving?-this.zVel:1,this.dVelocity.x=this.isMoving?this.xVel:1,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onAxisMove=this.onAxisMove.bind(this)},onTouchStart:function(e){switch(this.data.mode){case"swipe":this.canRecordAxis=!0,this.startingAxisData=[];break;case"touch":case"press":this.isMoving=!0}e.preventDefault()},onTouchEnd:function(e){"swipe"==this.data.mode&&(this.startingAxisData=[]),this.isMoving=!1,e.preventDefault()},onAxisMove:function(e){switch(this.data.mode){case"swipe":return this.handleSwipeAxis(e);case"touch":case"press":return this.handleTouchAxis(e)}},handleSwipeAxis:function(e){var t=this.data,i=e.detail.axis;if(0===this.startingAxisData.length&&this.canRecordAxis&&(this.canRecordAxis=!1,this.startingAxisData[0]=i[0],this.startingAxisData[1]=i[1]),this.startingAxisData.length>0){var n=0,o=0;t.enableNegX&&i[0]<this.startingAxisData[0]&&(n=-1),t.enablePosX&&i[0]>this.startingAxisData[0]&&(n=1),t.enablePosZ&&i[1]>this.startingAxisData[1]&&(o=-1),t.enableNegZ&&i[1]<this.startingAxisData[1]&&(o=1);var r=Math.abs(this.startingAxisData[1]-i[1]);Math.abs(this.startingAxisData[0]-i[0])>r?(this.zVel=0,this.xVel=n,this.isMoving=!0):(this.xVel=0,this.zVel=o,this.isMoving=!0)}},handleTouchAxis:function(e){var t=this.data,i=e.detail.axis,n=0,o=0;t.enableNegX&&i[0]<0&&(n=-1),t.enablePosX&&i[0]>0&&(n=1),t.enablePosZ&&i[1]>0&&(o=-1),t.enableNegZ&&i[1]<0&&(o=1),Math.abs(i[0])>Math.abs(i[1])?(this.zVel=0,this.xVel=n):(this.xVel=0,this.zVel=o)}})},{}],19:[function(e,t,i){"use strict";var n={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};function o(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}t.exports=AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(n)},repetitions:{default:1/0,min:0},timeScale:{default:1},startAt:{default:0}},init:function(){var e=this;this.model=null,this.mixer=null,this.activeActions=[];var t=this.el.getObject3D("mesh");t?this.load(t):this.el.addEventListener("model-loaded",function(t){e.el===t.detail.model.el&&e.load(t.detail.model)})},load:function(e){var t=this.el;this.model=e,this.mixer=new THREE.AnimationMixer(e),this.mixer.addEventListener("loop",function(e){t.emit("animation-loop",{action:e.action,loopDelta:e.loopDelta})}),this.mixer.addEventListener("finished",function(e){t.emit("animation-finished",{action:e.action,direction:e.direction})}),this.data.clip&&this.update({})},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(e){if(e){var t=this.data,i=AFRAME.utils.diff(t,e);if("clip"in i)return this.stopAction(),void(t.clip&&this.playAction());this.activeActions.forEach(function(e){"duration"in i&&t.duration&&e.setDuration(t.duration),"clampWhenFinished"in i&&(e.clampWhenFinished=t.clampWhenFinished),("loop"in i||"repetitions"in i)&&e.setLoop(n[t.loop],t.repetitions),"timeScale"in i&&e.setEffectiveTimeScale(t.timeScale)})}},stopAction:function(){for(var e=this.data,t=0;t<this.activeActions.length;t++)e.crossFadeDuration?this.activeActions[t].fadeOut(e.crossFadeDuration):this.activeActions[t].stop();this.activeActions.length=0},playAction:function(){if(this.mixer){var e=this.model,t=this.data,i=e.animations||(e.geometry||{}).animations||[];if(i.length)for(var r,a,s=(r=t.clip,new RegExp("^"+r.split(/\*+/).map(o).join(".*")+"$")),c=0;a=i[c];c++)if(a.name.match(s)){var l=this.mixer.clipAction(a,e);l.enabled=!0,l.clampWhenFinished=t.clampWhenFinished,t.duration&&l.setDuration(t.duration),1!==t.timeScale&&l.setEffectiveTimeScale(t.timeScale),l.startAt(this.mixer.time-t.startAt/1e3),l.setLoop(n[t.loop],t.repetitions).fadeIn(t.crossFadeDuration).play(),this.activeActions.push(l)}}},tick:function(e,t){this.mixer&&!isNaN(t)&&this.mixer.update(t/1e3)}})},{}],20:[function(e,t,i){"use strict";THREE.ColladaLoader=e("../../lib/ColladaLoader"),t.exports.Component=AFRAME.registerComponent("collada-model-legacy",{schema:{type:"asset"},init:function(){this.model=null,this.loader=new THREE.ColladaLoader},update:function(){var e=this,t=this.el,i=this.data,n=this.el.sceneEl.systems.renderer;i&&(this.remove(),this.loader.load(i,function(i){e.model=i.scene,e.model.traverse(function(e){if(e.isMesh){var t=e.material;t.color&&n.applyColorCorrection(t.color),t.map&&n.applyColorCorrection(t.map),t.emissive&&n.applyColorCorrection(t.emissive),t.emissiveMap&&n.applyColorCorrection(t.emissiveMap)}}),t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"collada",model:e.model})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{"../../lib/ColladaLoader":3}],21:[function(e,t,i){"use strict";THREE.FBXLoader=e("../../lib/FBXLoader"),t.exports=AFRAME.registerComponent("fbx-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){var e=this.data;if(e.src){this.remove();var t=new THREE.FBXLoader;e.crossorigin&&t.setCrossOrigin(e.crossorigin),t.load(e.src,this.load.bind(this))}},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"fbx",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{"../../lib/FBXLoader":4}],22:[function(e,t,i){"use strict";var n,o=e("../../lib/fetch-script")(),r=(n=void 0,function(){return n=n||o("https://cdn.jsdelivr.net/gh/mrdoob/three.js@r86/examples/js/loaders/GLTFLoader.js")});t.exports=AFRAME.registerComponent("gltf-model-legacy",{schema:{type:"model"},init:function(){var e=this;this.model=null,this.loader=null,this.loaderPromise=r().then(function(){e.loader=new THREE.GLTFLoader,e.loader.setCrossOrigin("Anonymous")})},update:function(){var e=this,t=this,i=this.el,n=this.data;n&&(this.remove(),this.loaderPromise.then(function(){e.loader.load(n,function(e){t.model=e.scene,t.model.animations=e.animations,i.setObject3D("mesh",t.model),i.emit("model-loaded",{format:"gltf",model:t.model})})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{"../../lib/fetch-script":7}],23:[function(e,t,i){"use strict";e("./animation-mixer"),e("./collada-model-legacy"),e("./fbx-model"),e("./gltf-model-legacy"),e("./object-model")},{"./animation-mixer":19,"./collada-model-legacy":20,"./fbx-model":21,"./gltf-model-legacy":22,"./object-model":24}],24:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("object-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){var e=this,t=void 0,i=this.data;i.src&&(this.remove(),t=new THREE.ObjectLoader,i.crossorigin&&t.setCrossOrigin(i.crossorigin),t.load(i.src,function(t){t.traverse(function(e){e instanceof THREE.SkinnedMesh&&e.material&&(e.material.skinning=!!(e.geometry&&e.geometry.bones||[]).length)}),e.load(t)}))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"json",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},{}],25:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("checkpoint",{schema:{offset:{default:{x:0,y:0,z:0},type:"vec3"}},init:function(){this.active=!1,this.targetEl=null,this.fire=this.fire.bind(this),this.offset=new THREE.Vector3},update:function(){this.offset.copy(this.data.offset)},play:function(){this.el.addEventListener("click",this.fire)},pause:function(){this.el.removeEventListener("click",this.fire)},remove:function(){this.pause()},fire:function(){var e=this.el.sceneEl.querySelector("[checkpoint-controls]");if(!e)throw new Error("No `checkpoint-controls` component found.");e.components["checkpoint-controls"].setCheckpoint(this.el)},getOffset:function(){return this.offset.copy(this.data.offset)}})},{}],26:[function(e,t,i){"use strict";function n(e,t,i,n){e&&(t=t||[],e.traverse(function(e){var o;e.isMesh&&((o=e.material)?Array.isArray(o)?o:o.materials?o.materials:[o]:[]).forEach(function(e){(!e||"envMap"in e)&&(t.length&&-1===t.indexOf(e.name)||(e.envMap=i,e.reflectivity=n,e.needsUpdate=!0))})}))}t.exports=AFRAME.registerComponent("cube-env-map",{multiple:!0,schema:{path:{default:""},extension:{default:"jpg",oneOf:["jpg","png"]},enableBackground:{default:!1},reflectivity:{default:1,min:0,max:1},materials:{default:[]}},init:function(){var e=this,t=this.data;this.texture=(new THREE.CubeTextureLoader).load([t.path+"posx."+t.extension,t.path+"negx."+t.extension,t.path+"posy."+t.extension,t.path+"negy."+t.extension,t.path+"posz."+t.extension,t.path+"negz."+t.extension]),this.texture.format=THREE.RGBAFormat,this.object3dsetHandler=function(){var t=e.el.getObject3D("mesh"),i=e.data;n(t,i.materials,e.texture,i.reflectivity)},this.object3dsetHandler(),this.el.addEventListener("object3dset",this.object3dsetHandler)},update:function(e){var t=this.data,i=this.el.getObject3D("mesh"),o=[],r=[];if(t.materials.length&&(e.materials?(o=t.materials.filter(function(t){return!e.materials.includes(t)}),r=e.materials.filter(function(e){return!t.materials.includes(e)})):o=t.materials),o.length&&n(i,o,this.texture,t.reflectivity),r.length&&n(i,r,null,1),e.materials&&t.reflectivity!==e.reflectivity){var a=t.materials.filter(function(t){return e.materials.includes(t)});a.length&&n(i,a,this.texture,t.reflectivity)}this.data.enableBackground&&!e.enableBackground?this.setBackground(this.texture):!this.data.enableBackground&&e.enableBackground&&this.setBackground(null)},remove:function(){this.el.removeEventListener("object3dset",this.object3dsetHandler);var e=this.el.getObject3D("mesh"),t=this.data;n(e,t.materials,null,1),t.enableBackground&&this.setBackground(null)},setBackground:function(e){this.el.sceneEl.object3D.background=e}})},{}],27:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("grab",{init:function(){this.system=this.el.sceneEl.systems.physics,this.GRABBED_STATE="grabbed",this.grabbing=!1,this.hitEl=null,this.physics=this.el.sceneEl.systems.physics,this.constraint=null,this.onHit=this.onHit.bind(this),this.onGripOpen=this.onGripOpen.bind(this),this.onGripClose=this.onGripClose.bind(this)},play:function(){var e=this.el;e.addEventListener("hit",this.onHit),e.addEventListener("gripdown",this.onGripClose),e.addEventListener("gripup",this.onGripOpen),e.addEventListener("trackpaddown",this.onGripClose),e.addEventListener("trackpadup",this.onGripOpen),e.addEventListener("triggerdown",this.onGripClose),e.addEventListener("triggerup",this.onGripOpen)},pause:function(){var e=this.el;e.removeEventListener("hit",this.onHit),e.removeEventListener("gripdown",this.onGripClose),e.removeEventListener("gripup",this.onGripOpen),e.removeEventListener("trackpaddown",this.onGripClose),e.removeEventListener("trackpadup",this.onGripOpen),e.removeEventListener("triggerdown",this.onGripClose),e.removeEventListener("triggerup",this.onGripOpen)},onGripClose:function(){this.grabbing=!0},onGripOpen:function(){var e=this.hitEl;this.grabbing=!1,e&&(e.removeState(this.GRABBED_STATE),this.hitEl=void 0,this.system.removeConstraint(this.constraint),this.constraint=null)},onHit:function(e){var t=e.detail.el;t.is(this.GRABBED_STATE)||!this.grabbing||this.hitEl||(t.addState(this.GRABBED_STATE),this.hitEl=t,this.constraint=new CANNON.LockConstraint(this.el.body,t.body),this.system.addConstraint(this.constraint))}})},{}],28:[function(e,t,i){"use strict";e("./checkpoint"),e("./cube-env-map"),e("./grab"),e("./normal-material"),e("./sphere-collider")},{"./checkpoint":25,"./cube-env-map":26,"./grab":27,"./normal-material":29,"./sphere-collider":30}],29:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("normal-material",{init:function(){this.material=new THREE.MeshNormalMaterial({flatShading:!0}),this.applyMaterial=this.applyMaterial.bind(this),this.el.addEventListener("object3dset",this.applyMaterial),this.applyMaterial()},remove:function(){this.el.removeEventListener("object3dset",this.applyMaterial)},applyMaterial:function(){var e=this;this.el.object3D.traverse(function(t){t.isMesh&&(t.material=e.material)})}})},{}],30:[function(e,t,i){"use strict";var n,o,r,a,s,c,l;t.exports=AFRAME.registerComponent("sphere-collider",{schema:{enabled:{default:!0},interval:{default:80},objects:{default:""},state:{default:"collided"},radius:{default:.05},watch:{default:!0}},init:function(){this.observer=null,this.els=[],this.collisions=[],this.prevCheckTime=void 0,this.eventDetail={},this.handleHit=this.handleHit.bind(this),this.handleHitEnd=this.handleHitEnd.bind(this)},play:function(){var e=this.el.sceneEl;this.data.watch&&(this.observer=new MutationObserver(this.update.bind(this,null)),this.observer.observe(e,{childList:!0,subtree:!0}))},pause:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},update:function(){var e=this.data,t=void 0;t=e.objects?this.el.sceneEl.querySelectorAll(e.objects):this.el.sceneEl.children,this.els=Array.prototype.slice.call(t)},tick:(n=new THREE.Vector3,o=new THREE.Vector3,r=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Box3,c=[],l=new Map,function(e){if(this.data.enabled){var t=this.prevCheckTime;if(!(t&&e-t<this.data.interval)){this.prevCheckTime=e;var i,d=this.el,h=this.data,u=void 0;d.getObject3D("mesh")&&(c.length=0,l.clear(),d.object3D.getWorldPosition(n),d.object3D.getWorldScale(r),u=h.radius*(i=r,Math.max(i.x,i.y,i.z)),this.els.forEach(function(e){var t=void 0,i=void 0,r=void 0,d=void 0;e.isEntity&&(i=e.getObject3D("mesh"))&&(s.setFromObject(i).getSize(a),d=Math.max(a.x,a.y,a.z)/2,t=Math.sqrt(2*d*d),s.getCenter(o),t&&(r=n.distanceTo(o))<t+u&&(c.push(e),l.set(e,r)))}),c.sort(function(e,t){return l.get(e)>l.get(t)?1:-1}).forEach(this.handleHit),this.collisions.filter(function(e){return!l.has(e)}).forEach(this.handleHitEnd),function(e,t){e.length=0;for(var i=0;i<t.length;i++)e[i]=t[i]}(this.collisions,c))}}}),handleHit:function(e){e.emit("hit"),e.addState(this.data.state),this.eventDetail.el=e,this.el.emit("hit",this.eventDetail)},handleHitEnd:function(e){e.emit("hitend"),e.removeState(this.data.state),this.eventDetail.el=e,this.el.emit("hitend",this.eventDetail)}})},{}],31:[function(e,t,i){"use strict";e("./nav-mesh"),e("./nav-terrian"),e("./nav-agent"),e("./system")},{"./nav-agent":32,"./nav-mesh":33,"./nav-terrian":34,"./system":35}],32:[function(e,t,i){"use strict";var n,o,r,a,s,c,l,d,h,u,p,f,m=Math.PI/2;t.exports=AFRAME.registerComponent("nav-agent",{schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2},gazeTarget:{type:"selector"},mode:{default:"animate",oneOf:["teleport","animate"]},viewSync:{default:!0,type:"boolean"}},init:function(){var e=this;this.system=this.el.sceneEl.systems.nav,this.system.addAgent(this),this.group=null,this.path=[],this.raycaster=new THREE.Raycaster,this.camera=null,this.lookControls=null,this.el.object3D.traverse(function(t){t instanceof THREE.Camera&&(e.camera=t,e.lookControls=t.el.components["look-controls"])})},remove:function(){this.system.removeAgent(this)},update:function(){this.path.length=0,this.clearState()},updateNavLocation:function(){this.group=null,this.path=[]},isMWControlsEnabled:function(){var e=this.lookControls;return!!(e&&e.magicWindowControls&&e.magicWindowControls.enabled)},_getGazeTarget:function(e,t,i){if(t.getWorldPosition(e),this.data.gazeTarget&&this.data.gazeTarget.object3D){var n=this.data.gazeTarget.object3D.position;e.setX(n.x),e.setZ(n.z)}else e.setX(i.x),e.setZ(i.z)},_getVQuaternion:function(e,t,i,n,o){t.copy(i.quaternion),this._getGazeTarget(n,i,o),i.lookAt(n),e.copy(i.quaternion),i.setRotationFromQuaternion(t)},_updateRotation:function(e,t,i,n,o){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.1;if(this.lookControls){if(this.lookControls.touchStarted&&this.lookControls.data.touchEnabled||this.lookControls.mouseDown);else if(r){e.setFromQuaternion(i,"YXZ"),i.slerp(n,r),t.setFromQuaternion(i,"YXZ");var a=this.lookControls.magicWindowDeltaEuler;a.x=0,a.y=0,a.z=0;var s=this.lookControls.pitchObject;s.rotation.x+=t.x-e.x,s.rotation.x=Math.max(-m,Math.min(m,s.rotation.x)),this.lookControls.yawObject.rotation.y+=t.y-e.y}}else o.quaternion.slerp(n,r)},tick:(s=new THREE.Vector3,c=new THREE.Vector3,l=new THREE.Vector3,d=new THREE.Quaternion,h=new THREE.Quaternion,u=new THREE.Vector3,p=new THREE.Euler,f=new THREE.Euler,function(e,t){var i=this.el,n=this.data;if(this.raycaster,n.active){var o=n.speed*t/1e3,r=this.lookControls?this.camera:i.object3D,a=this.getNavStart(i.object3D);if(!this.path.length){var m=a;s.copy(n.destination),this.group=this.group||this.system.getGroup(m);var v=this.system.getNode(m,this.group),y=this.system.getNode(s,this.group);v&&y&&y.id===v.id?this.path=[s.clone()]:this.path=this.system.getPath(m,s,this.group)||[],i.emit("navigation-start")}if(!this.path.length)return console.warn("[nav] Unable to find path to %o.",n.destination),this.el.setAttribute("nav-agent",{active:!1}),void i.emit("navigation-end");var g=this.path[0];if(c.subVectors(g,a),"teleport"===this.data.mode){var E=this.path[this.path.length-1];return a.copy(E),this.terrianMove(i.object3D,t),this.data.viewSync&&!this.isMWControlsEnabled()&&this.data.gazeTarget&&this.data.gazeTarget.object3D&&(this._getVQuaternion(d,h,r,u,null),this._updateRotation(f,p,h,d,r,1)),this.el.setAttribute("nav-agent",{active:!1,gazeTarget:null}),void i.emit("navigation-end")}var b=void 0;if(c.length()<o){var k=this.path.shift(),w=this.isMWControlsEnabled(),T=w?0:THREE.MathUtils.radToDeg(r.quaternion.angleTo(d));this.data.viewSync||(T=0);var x=Math.abs(T)<.2;if(!this.path.length&&x)return!w&&this.data.viewSync&&(this._getVQuaternion(d,h,r,u,k),this._updateRotation(f,p,h,d,r,1)),this.el.setAttribute("nav-agent",{active:!1,gazeTarget:null}),void i.emit("navigation-end");this.path.length||w||x||this.path.push(k),l.copy(a),b=this.path[0]}else l.copy(c.setLength(o)).add(a),b=g;!this.isMWControlsEnabled()&&this.data.viewSync&&(this._getVQuaternion(d,h,r,u,b),this._updateRotation(f,p,h,d,r)),a.copy(l),this.terrianMove(i.object3D,t)}}),getNavStart:function(e){return e._navPoint||(e._navPoint=this.system.getNavStart(e.position),e._navPoint?e._navPoint=e._navPoint.point:(e._navPoint=new THREE.Vector3,e._navPoint.copy(e.position))),e._navPoint},clearState:function(){delete this.el.object3D._navPoint,this.updateNavLocation()},terrianMove:(n=new THREE.Vector3,o=new THREE.Vector3,r=new THREE.Vector3,a=new THREE.Vector3(0,1,0),function(e,t){e.getWorldPosition(n),e.position.copy(e._navPoint);var i=this.system.getTerrianIntersect(e._navPoint);i&&(i.point.equals(n)||(o.subVectors(i.point,n),r.copy(o),r.projectOnPlane(a),(0==r.lengthSq()?1/0:r.angleTo(o))>Math.PI/4&&Math.abs(i.point.y-n.y)>.001&&(i.point.y>n.y?this.el.emit("nav-agent-move",{move:"up"}):this.el.emit("nav-agent-move",{move:"down"}))),e.position.y=i.point.y)})})},{}],33:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("nav-mesh",{schema:{nodeName:{type:"string"}},init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.nodeName=this.data.nodeName,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){var e=this,t=this.el.getObject3D("mesh");this.el.sceneEl.object3D;if(t){var i=void 0;if(t.traverse(function(t){!t.isMesh||e.nodeName&&t.name!==e.nodeName||(i=t)}),i){var n=i.geometry.clone();i.updateWorldMatrix(!0,!1),n.applyMatrix4(i.matrixWorld),this.system.setNavMeshGeometry(n),this.hasLoadedNavMesh=!0}}}})},{}],34:[function(e,t,i){"use strict";t.exports=AFRAME.registerComponent("nav-terrian",{schema:{terrianName:{type:"string"}},init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.nodeName=this.data.nodeName,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){var e=this,t=this.el.getObject3D("mesh"),i=this.el.sceneEl.object3D;if(t){var n=void 0;t.traverse(function(t){t.isObject3D&&t.name===e.data.terrianName&&(n=t)}),n&&(i.updateMatrixWorld(),this.system.setTerrianMesh(n),this.hasLoadedNavMesh=!0)}}})},{}],35:[function(e,t,i){"use strict";var n,o,r,a,s=e("three-pathfinding").Pathfinding,c=new s,l="level";t.exports=AFRAME.registerSystem("nav",{init:function(){this.navMesh=null,this.agents=new Set,this.terrianMesh=null},setNavMeshGeometry:function(e){this.navMesh=new THREE.Mesh(e),c.setZoneData(l,s.createZone(e)),Array.from(this.agents).forEach(function(e){return e.updateNavLocation()})},getNavMesh:function(){return this.navMesh},addAgent:function(e){this.agents.add(e)},removeAgent:function(e){this.agents.delete(e)},getPath:function(e,t,i){return this.navMesh?c.findPath(e,t,l,i):null},getGroup:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.navMesh?c.getGroup(l,e,t):null},getNode:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.navMesh?c.getClosestNode(e,l,t,i):null},clampStep:function(e,t,i,n,o){return this.navMesh?n?c.clampStep(e,t,n,l,i,o):(o.copy(t),this.getNode(t,i)):(o.copy(t),null)},setTerrianMesh:function(e){this.terrianMesh=e},getTerrianMesh:function(){return this.terrianMesh},getTerrianIntersect:function(e){return this.projectPoint(e,this.terrianMesh)},getNavStart:function(e){return this.projectPoint(e,this.navMesh)},projectPoint:(n=new THREE.Vector3,o=new THREE.Vector3(0,-1,0),r=new THREE.Raycaster(n,o),a=[],function(e,t){if(t&&e){n.copy(e),n.y+=1.5,r.set(n,o),a.length=0;var i=r.intersectObject(t,!0,a);if(i&&i.length>0){var s=i[0];return a.length=0,s}}})})},{"three-pathfinding":10}],36:[function(e,t,i){"use strict";t.exports=AFRAME.registerPrimitive("a-grid",{defaultComponents:{geometry:{primitive:"plane",width:75,height:75},rotation:{x:-90,y:0,z:0},material:{src:"url(https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v1.16.3/assets/grid.png)",repeat:"75 75"}},mappings:{width:"geometry.width",height:"geometry.height",src:"material.src"}})},{}],37:[function(e,t,i){"use strict";t.exports.Primitive=AFRAME.registerPrimitive("a-ocean",{defaultComponents:{ocean:{},rotation:{x:-90,y:0,z:0}},mappings:{width:"ocean.width",depth:"ocean.depth",density:"ocean.density",amplitude:"ocean.amplitude",amplitudeVariance:"ocean.amplitudeVariance",speed:"ocean.speed",speedVariance:"ocean.speedVariance",color:"ocean.color",opacity:"ocean.opacity"}}),t.exports.Component=AFRAME.registerComponent("ocean",{schema:{width:{default:10,min:0},depth:{default:10,min:0},density:{default:10},amplitude:{default:.1},amplitudeVariance:{default:.3},speed:{default:1},speedVariance:{default:2},color:{default:"#7AD2F7",type:"color"},opacity:{default:.8}},play:function(){var e=this.el,t=this.data,i=e.components.material,n=new THREE.PlaneGeometry(t.width,t.depth,t.density,t.density);this.waves=[];for(var o=n.getAttribute("position"),r=0;r<o.count;r++)this.waves.push({z:o.getZ(r),ang:Math.random()*Math.PI*2,amp:t.amplitude+Math.random()*t.amplitudeVariance,speed:(t.speed+Math.random()*t.speedVariance)/1e3});i||((i={}).material=new THREE.MeshPhongMaterial({color:t.color,transparent:t.opacity<1,opacity:t.opacity,flatShading:!0})),this.mesh=new THREE.Mesh(n,i.material),e.setObject3D("mesh",this.mesh)},remove:function(){this.el.removeObject3D("mesh")},tick:function(e,t){if(t){for(var i=this.mesh.geometry.getAttribute("position"),n=0;n<i.count;n++){var o=this.waves[n],r=o.z+Math.sin(o.ang)*o.amp;i.setZ(n,r),o.ang+=o.speed*t}i.needsUpdate=!0}}})},{}],38:[function(e,t,i){"use strict";t.exports.Primitive=AFRAME.registerPrimitive("a-tube",{defaultComponents:{tube:{}},mappings:{path:"tube.path",segments:"tube.segments",radius:"tube.radius","radial-segments":"tube.radialSegments",closed:"tube.closed"}}),t.exports.Component=AFRAME.registerComponent("tube",{schema:{path:{default:[]},segments:{default:64},radius:{default:1},radialSegments:{default:8},closed:{default:!1}},init:function(){var e=this.el,t=this.data,i=e.components.material;if(t.path.length){var n=new THREE.CatmullRomCurve3(t.path.map(function(e){return e=e.split(" "),new THREE.Vector3(Number(e[0]),Number(e[1]),Number(e[2]))})),o=new THREE.TubeGeometry(n,t.segments,t.radius,t.radialSegments,t.closed);i||((i={}).material=new THREE.MeshPhongMaterial),this.mesh=new THREE.Mesh(o,i.material),this.el.setObject3D("mesh",this.mesh)}else console.error("[a-tube] `path` property expected but not found.")},update:function(e){Object.keys(e).length&&(this.remove(),this.init())},remove:function(){this.mesh&&this.el.removeObject3D("mesh")}})},{}],39:[function(e,t,i){"use strict";e("./a-grid"),e("./a-ocean"),e("./a-tube")},{"./a-grid":36,"./a-ocean":37,"./a-tube":38}]},{},[1]);