!function(){return function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){return i(e[s][1][t]||t)},c,c.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}}()({1:[function(t,e,n){"use strict";t("./src/pathfinding")},{"./src/pathfinding":3}],2:[function(t,e,n){var r=t("three");function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function s(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,h=function(){function t(){}return t.roundNumber=function(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n},t.sample=function(t){return t[Math.floor(Math.random()*t.length)]},t.distanceToSquared=function(t,e){var n=t.x-e.x,r=t.y-e.y,i=t.z-e.z;return n*n+r*r+i*i},t.isPointInPoly=function(t,e){for(var n=!1,r=-1,i=t.length,o=i-1;++r<i;o=r)(t[r].z<=e.z&&e.z<t[o].z||t[o].z<=e.z&&e.z<t[r].z)&&e.x<(t[o].x-t[r].x)*(e.z-t[r].z)/(t[o].z-t[r].z)+t[r].x&&(n=!n);return n},t.isVectorInPolygon=function(t,e,n){var r=1e5,i=-1e5,o=[];return e.vertexIds.forEach(function(t){r=Math.min(n[t].y,r),i=Math.max(n[t].y,i),o.push(n[t])}),!!(t.y<i+.5&&t.y>r-.5&&this.isPointInPoly(o,t))},t.triarea2=function(t,e,n){return(n.x-t.x)*(e.z-t.z)-(e.x-t.x)*(n.z-t.z)},t.vequal=function(t,e){return this.distanceToSquared(t,e)<1e-5},t.mergeVertices=function(t,e){void 0===e&&(e=1e-4),e=Math.max(e,Number.EPSILON);for(var n={},i=t.getIndex(),o=t.getAttribute("position"),s=i?i.count:o.count,a=0,h=[],u=[],c=Math.log10(1/e),l=Math.pow(10,c),d=0;d<s;d++){var v=i?i.getX(d):d,p="";p+=~~(o.getX(v)*l)+",",p+=~~(o.getY(v)*l)+",",(p+=~~(o.getZ(v)*l)+",")in n?h.push(n[p]):(u.push(o.getX(v)),u.push(o.getY(v)),u.push(o.getZ(v)),n[p]=a,h.push(a),a++)}var f=new r.BufferAttribute(new Float32Array(u),o.itemSize,o.normalized),g=new r.BufferGeometry;return g.setAttribute("position",f),g.setIndex(h),g},t}(),u=function(){function t(t){this.content=[],this.scoreFunction=t}var e=t.prototype;return e.push=function(t){this.content.push(t),this.sinkDown(this.content.length-1)},e.pop=function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t},e.remove=function(t){var e=this.content.indexOf(t),n=this.content.pop();e!==this.content.length-1&&(this.content[e]=n,this.scoreFunction(n)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},e.size=function(){return this.content.length},e.rescoreElement=function(t){this.sinkDown(this.content.indexOf(t))},e.sinkDown=function(t){for(var e=this.content[t];t>0;){var n=(t+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(r)))break;this.content[n]=e,this.content[t]=r,t=n}},e.bubbleUp=function(t){for(var e=this.content.length,n=this.content[t],r=this.scoreFunction(n);;){var i=t+1<<1,o=i-1,s=null,a=void 0;if(o<e&&(a=this.scoreFunction(this.content[o]))<r&&(s=o),i<e&&this.scoreFunction(this.content[i])<(null===s?r:a)&&(s=i),null===s)break;this.content[t]=this.content[s],this.content[s]=n,t=s}},t}(),c=function(){function t(){}return t.init=function(t){for(var e=0;e<t.length;e++){var n=t[e];n.f=0,n.g=0,n.h=0,n.cost=1,n.visited=!1,n.closed=!1,n.parent=null}},t.cleanUp=function(t){for(var e=0;e<t.length;e++){var n=t[e];delete n.f,delete n.g,delete n.h,delete n.cost,delete n.visited,delete n.closed,delete n.parent}},t.heap=function(){return new u(function(t){return t.f})},t.search=function(t,e,n){this.init(t);var r=this.heap();for(r.push(e);r.size()>0;){var i=r.pop();if(i===n){for(var o=i,s=[];o.parent;)s.push(o),o=o.parent;return this.cleanUp(s),s.reverse()}i.closed=!0;for(var a=this.neighbours(t,i),h=0,u=a.length;h<u;h++){var c=a[h];if(!c.closed){var l=i.g+c.cost,d=c.visited;if(!d||l<c.g){if(c.visited=!0,c.parent=i,!c.centroid||!n.centroid)throw new Error("Unexpected state");c.h=c.h||this.heuristic(c.centroid,n.centroid),c.g=l,c.f=c.g+c.h,d?r.rescoreElement(c):r.push(c)}}}}return[]},t.heuristic=function(t,e){return h.distanceToSquared(t,e)},t.neighbours=function(t,e){for(var n=[],r=0;r<e.neighbours.length;r++)n.push(t[e.neighbours[r]]);return n},t}(),l=function(){function t(){}return t.buildZone=function(t,e){var n=this,i=this._buildNavigationMesh(t,e),o={};i.vertices.forEach(function(t){t.x=h.roundNumber(t.x,2),t.y=h.roundNumber(t.y,2),t.z=h.roundNumber(t.z,2)}),o.vertices=i.vertices;var s=this._buildPolygonGroups(i);return o.groups=new Array(s.length),s.forEach(function(t,e){var i=new Map;t.forEach(function(t,e){i.set(t,e)});var s=new Array(t.length);t.forEach(function(t,e){var a=[];t.neighbours.forEach(function(t){return a.push(i.get(t))});var u=[];t.neighbours.forEach(function(e){return u.push(n._getSharedVerticesInOrder(t,e))});var c=new r.Vector3(0,0,0);c.add(o.vertices[t.vertexIds[0]]),c.add(o.vertices[t.vertexIds[1]]),c.add(o.vertices[t.vertexIds[2]]),c.divideScalar(3),c.x=h.roundNumber(c.x,2),c.y=h.roundNumber(c.y,2),c.z=h.roundNumber(c.z,2),s[e]={id:e,neighbours:a,vertexIds:t.vertexIds,centroid:c,portals:u}}),o.groups[e]=s}),o},t._buildNavigationMesh=function(t,e){return t=h.mergeVertices(t,e),this._buildPolygonsFromGeometry(t)},t._spreadGroupId=function(t){for(var e=new Set([t]);e.size>0;){var n=e;e=new Set,n.forEach(function(n){n.group=t.group,n.neighbours.forEach(function(t){void 0===t.group&&e.add(t)})})}},t._buildPolygonGroups=function(t){var e=this,n=[];return t.polygons.forEach(function(t){void 0!==t.group?n[t.group].push(t):(t.group=n.length,e._spreadGroupId(t),n.push([t]))}),n},t._buildPolygonNeighbours=function(t,e){var n=new Set,r=e[t.vertexIds[1]],i=e[t.vertexIds[2]];return e[t.vertexIds[0]].forEach(function(e){e!==t&&(r.includes(e)||i.includes(e))&&n.add(e)}),r.forEach(function(e){e!==t&&i.includes(e)&&n.add(e)}),n},t._buildPolygonsFromGeometry=function(t){for(var e=this,n=[],i=[],o=t.attributes.position,s=t.index,a=[],h=0;h<o.count;h++)i.push((new r.Vector3).fromBufferAttribute(o,h)),a[h]=[];for(var u=0;u<t.index.count;u+=3){var c=s.getX(u),l=s.getX(u+1),d=s.getX(u+2),v={vertexIds:[c,l,d],neighbours:null};n.push(v),a[c].push(v),a[l].push(v),a[d].push(v)}return n.forEach(function(t){t.neighbours=e._buildPolygonNeighbours(t,a)}),{polygons:n,vertices:i}},t._getSharedVerticesInOrder=function(t,e){var n=t.vertexIds,r=n[0],i=n[1],o=n[2],s=e.vertexIds,a=s.includes(r),h=s.includes(i),u=s.includes(o);return a&&h&&u?Array.from(n):a&&h?[r,i]:h&&u?[i,o]:a&&u?[o,r]:(console.warn("Error processing navigation mesh neighbors; neighbors with <2 shared vertices found."),[])},t}(),d=function(){function t(){this.portals=[]}var e=t.prototype;return e.push=function(t,e){void 0===e&&(e=t),this.portals.push({left:t,right:e})},e.stringPull=function(){var t,e,n,r=this.portals,i=[],o=0,s=0,a=0;e=r[0].left,n=r[0].right,i.push(t=r[0].left);for(var u=1;u<r.length;u++){var c=r[u].left,l=r[u].right;if(h.triarea2(t,n,l)<=0){if(!(h.vequal(t,n)||h.triarea2(t,e,l)>0)){i.push(e),e=t=e,n=t,s=o=s,a=o,u=o;continue}n=l,a=u}if(h.triarea2(t,e,c)>=0){if(!(h.vequal(t,e)||h.triarea2(t,n,c)<0)){i.push(n),e=t=n,n=t,s=o=a,a=o,u=o;continue}e=c,s=u}}return 0!==i.length&&h.vequal(i[i.length-1],r[r.length-1].left)||i.push(r[r.length-1].left),this.path=i,i},t}(),v=function(){function t(){this.zones={}}t.createZone=function(t,e){return void 0===e&&(e=1e-4),l.buildZone(t,e)};var e=t.prototype;return e.setZoneData=function(t,e){this.zones[t]=e},e.getRandomNode=function(t,e,n,i){if(!this.zones[t])return new r.Vector3;n=n||null,i=i||0;var o=[];return this.zones[t].groups[e].forEach(function(t){n&&i?h.distanceToSquared(n,t.centroid)<i*i&&o.push(t.centroid):o.push(t.centroid)}),h.sample(o)||new r.Vector3},e.getClosestNode=function(t,e,n,r){void 0===r&&(r=!1);var i=this.zones[e].vertices,o=null,s=1/0;return this.zones[e].groups[n].forEach(function(e){var n=h.distanceToSquared(e.centroid,t);n<s&&(!r||h.isVectorInPolygon(t,e,i))&&(o=e,s=n)}),o},e.findPath=function(t,e,n,i){var o=this.zones[n].groups[i],s=this.zones[n].vertices,a=this.getClosestNode(t,n,i,!1),h=this.getClosestNode(e,n,i,!0);if(!a||!h)return null;var u=c.search(o,a,h),l=function(t,e){for(var n=0;n<t.neighbours.length;n++)if(t.neighbours[n]===e.id)return t.portals[n]},v=new d;v.push(t);for(var p=0;p<u.length;p++){var f=u[p+1];if(f){var g=l(u[p],f);v.push(s[g[0]],s[g[1]])}}v.push(e),v.stringPull();var m=v.path.map(function(t){return new r.Vector3(t.x,t.y,t.z)});return m.shift(),m},t}();v.prototype.getGroup=(a=new r.Plane,function(t,e,n){if(void 0===n&&(n=!1),!this.zones[t])return null;for(var r=null,i=Math.pow(50,2),o=this.zones[t],u=0;u<o.groups.length;u++)for(var c,l=s(o.groups[u]);!(c=l()).done;){var d=c.value;if(n&&(a.setFromCoplanarPoints(o.vertices[d.vertexIds[0]],o.vertices[d.vertexIds[1]],o.vertices[d.vertexIds[2]]),Math.abs(a.distanceToPoint(e))<.01&&h.isPointInPoly([o.vertices[d.vertexIds[0]],o.vertices[d.vertexIds[1]],o.vertices[d.vertexIds[2]]],e)))return u;var v=h.distanceToSquared(d.centroid,e);v<i&&(r=u,i=v)}return r}),v.prototype.clampStep=function(){var t,e,n=new r.Vector3,i=new r.Plane,o=new r.Triangle,s=new r.Vector3,a=new r.Vector3;return function(r,h,u,c,l,d){var v=this.zones[c].vertices,p=this.zones[c].groups[l],f=[u],g={};g[u.id]=0,t=void 0,a.set(0,0,0),e=1/0,i.setFromCoplanarPoints(v[u.vertexIds[0]],v[u.vertexIds[1]],v[u.vertexIds[2]]),i.projectPoint(h,n),s.copy(n);for(var m=f.pop();m;m=f.pop()){o.set(v[m.vertexIds[0]],v[m.vertexIds[1]],v[m.vertexIds[2]]),o.closestPointToPoint(s,n),n.distanceToSquared(s)<e&&(t=m,a.copy(n),e=n.distanceToSquared(s));var y=g[m.id];if(!(y>2))for(var M=0;M<m.neighbours.length;M++){var b=p[m.neighbours[M]];b.id in g||(f.push(b),g[b.id]=y+1)}}return d.copy(a),t}}();var p={PLAYER:new r.Color(15631215).convertGammaToLinear(2.2).getHex(),TARGET:new r.Color(14469912).convertGammaToLinear(2.2).getHex(),PATH:new r.Color(41903).convertGammaToLinear(2.2).getHex(),WAYPOINT:new r.Color(41903).convertGammaToLinear(2.2).getHex(),CLAMPED_STEP:new r.Color(14472114).convertGammaToLinear(2.2).getHex(),CLOSEST_NODE:new r.Color(4417387).convertGammaToLinear(2.2).getHex()},f=function(t){var e,n;function o(){var e;return(e=t.call(this)||this)._playerMarker=new r.Mesh(new r.SphereBufferGeometry(.25,32,32),new r.MeshBasicMaterial({color:p.PLAYER})),e._targetMarker=new r.Mesh(new r.BoxBufferGeometry(.3,.3,.3),new r.MeshBasicMaterial({color:p.TARGET})),e._nodeMarker=new r.Mesh(new r.BoxBufferGeometry(.1,.8,.1),new r.MeshBasicMaterial({color:p.CLOSEST_NODE})),e._stepMarker=new r.Mesh(new r.BoxBufferGeometry(.1,1,.1),new r.MeshBasicMaterial({color:p.CLAMPED_STEP})),e._pathMarker=new r.Object3D,e._pathLineMaterial=new r.LineBasicMaterial({color:p.PATH,linewidth:2}),e._pathPointMaterial=new r.MeshBasicMaterial({color:p.WAYPOINT}),e._pathPointGeometry=new r.SphereBufferGeometry(.08),e._markers=[e._playerMarker,e._targetMarker,e._nodeMarker,e._stepMarker,e._pathMarker],e._markers.forEach(function(t){t.visible=!1,e.add(t)}),e}n=t,(e=o).prototype=Object.create(n.prototype),e.prototype.constructor=e,i(e,n);var s=o.prototype;return s.setPath=function(t){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);t=[this._playerMarker.position].concat(t);var e=new r.BufferGeometry;e.setAttribute("position",new r.BufferAttribute(new Float32Array(3*t.length),3));for(var n=0;n<t.length;n++)e.attributes.position.setXYZ(n,t[n].x,t[n].y+.2,t[n].z);this._pathMarker.add(new r.Line(e,this._pathLineMaterial));for(var i=0;i<t.length-1;i++){var o=new r.Mesh(this._pathPointGeometry,this._pathPointMaterial);o.position.copy(t[i]),o.position.y+=.2,this._pathMarker.add(o)}return this._pathMarker.visible=!0,this},s.setPlayerPosition=function(t){return this._playerMarker.position.copy(t),this._playerMarker.visible=!0,this},s.setTargetPosition=function(t){return this._targetMarker.position.copy(t),this._targetMarker.visible=!0,this},s.setNodePosition=function(t){return this._nodeMarker.position.copy(t),this._nodeMarker.visible=!0,this},s.setStepPosition=function(t){return this._stepMarker.position.copy(t),this._stepMarker.visible=!0,this},s.reset=function(){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);return this._markers.forEach(function(t){t.visible=!1}),this},o}(r.Object3D);n.Pathfinding=v,n.PathfindingHelper=f},{three:"three"}],3:[function(t,e,n){"use strict";t("./nav-mesh"),t("./nav-terrian"),t("./nav-agent"),t("./system")},{"./nav-agent":4,"./nav-mesh":5,"./nav-terrian":6,"./system":7}],4:[function(t,e,n){"use strict";var r,i,o,s,a,h,u,c,l,d,v,p,f=Math.PI/2;e.exports=AFRAME.registerComponent("nav-agent",{schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2},gazeTarget:{type:"selector"},mode:{default:"animate",oneOf:["teleport","animate"]},viewSync:{default:!0,type:"boolean"}},init:function(){var t=this;this.system=this.el.sceneEl.systems.nav,this.system.addAgent(this),this.group=null,this.path=[],this.raycaster=new THREE.Raycaster,this.camera=null,this.lookControls=null,this.el.object3D.traverse(function(e){e instanceof THREE.Camera&&(t.camera=e,t.lookControls=e.el.components["look-controls"])})},remove:function(){this.system.removeAgent(this)},update:function(){this.path.length=0,this.clearState()},updateNavLocation:function(){this.group=null,this.path=[]},isMWControlsEnabled:function(){var t=this.lookControls;return!!(t&&t.magicWindowControls&&t.magicWindowControls.enabled)},_getGazeTarget:function(t,e,n){if(e.getWorldPosition(t),this.data.gazeTarget&&this.data.gazeTarget.object3D){var r=this.data.gazeTarget.object3D.position;t.setX(r.x),t.setZ(r.z)}else t.setX(n.x),t.setZ(n.z)},_getVQuaternion:function(t,e,n,r,i){e.copy(n.quaternion),this._getGazeTarget(r,n,i),n.lookAt(r),t.copy(n.quaternion),n.setRotationFromQuaternion(e)},_updateRotation:function(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.1;if(this.lookControls){if(this.lookControls.touchStarted&&this.lookControls.data.touchEnabled||this.lookControls.mouseDown);else if(o){t.setFromQuaternion(n,"YXZ"),n.slerp(r,o),e.setFromQuaternion(n,"YXZ");var s=this.lookControls.magicWindowDeltaEuler;s.x=0,s.y=0,s.z=0;var a=this.lookControls.pitchObject;a.rotation.x+=e.x-t.x,a.rotation.x=Math.max(-f,Math.min(f,a.rotation.x)),this.lookControls.yawObject.rotation.y+=e.y-t.y}}else i.quaternion.slerp(r,o)},tick:(a=new THREE.Vector3,h=new THREE.Vector3,u=new THREE.Vector3,c=new THREE.Quaternion,l=new THREE.Quaternion,d=new THREE.Vector3,v=new THREE.Euler,p=new THREE.Euler,function(t,e){var n=this.el,r=this.data;if(this.raycaster,r.active){var i=r.speed*e/1e3,o=this.lookControls?this.camera:n.object3D,s=this.getNavStart(n.object3D);if(!this.path.length){var f=s;a.copy(r.destination),this.group=this.group||this.system.getGroup(f);var g=this.system.getNode(f,this.group),m=this.system.getNode(a,this.group);g&&m&&m.id===g.id?this.path=[a.clone()]:this.path=this.system.getPath(f,a,this.group)||[],n.emit("navigation-start")}if(!this.path.length)return console.warn("[nav] Unable to find path to %o.",r.destination),this.el.setAttribute("nav-agent",{active:!1}),void n.emit("navigation-end");var y=this.path[0];if(h.subVectors(y,s),"teleport"===this.data.mode){var M=this.path[this.path.length-1];return s.copy(M),this.terrianMove(n.object3D,e),this.data.viewSync&&!this.isMWControlsEnabled()&&this.data.gazeTarget&&this.data.gazeTarget.object3D&&(this._getVQuaternion(c,l,o,d,null),this._updateRotation(p,v,l,c,o,1)),this.el.setAttribute("nav-agent",{active:!1,gazeTarget:null}),void n.emit("navigation-end")}var b=void 0;if(h.length()<i){var w=this.path.shift(),E=this.isMWControlsEnabled(),_=E?0:THREE.MathUtils.radToDeg(o.quaternion.angleTo(c));this.data.viewSync||(_=0);var x=Math.abs(_)<.2;if(!this.path.length&&x)return!E&&this.data.viewSync&&(this._getVQuaternion(c,l,o,d,w),this._updateRotation(p,v,l,c,o,1)),this.el.setAttribute("nav-agent",{active:!1,gazeTarget:null}),void n.emit("navigation-end");this.path.length||E||x||this.path.push(w),u.copy(s),b=this.path[0]}else u.copy(h.setLength(i)).add(s),b=y;!this.isMWControlsEnabled()&&this.data.viewSync&&(this._getVQuaternion(c,l,o,d,b),this._updateRotation(p,v,l,c,o)),s.copy(u),this.terrianMove(n.object3D,e)}}),getNavStart:function(t){return t._navPoint||(t._navPoint=this.system.getNavStart(t.position),t._navPoint?t._navPoint=t._navPoint.point:(t._navPoint=new THREE.Vector3,t._navPoint.copy(t.position))),t._navPoint},clearState:function(){delete this.el.object3D._navPoint,this.updateNavLocation()},terrianMove:(r=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Vector3,s=new THREE.Vector3(0,1,0),function(t,e){t.getWorldPosition(r),t.position.copy(t._navPoint);var n=this.system.getTerrianIntersect(t._navPoint);n&&(n.point.equals(r)||(i.subVectors(n.point,r),o.copy(i),o.projectOnPlane(s),(0==o.lengthSq()?1/0:o.angleTo(i))>Math.PI/4&&Math.abs(n.point.y-r.y)>.001&&(n.point.y>r.y?this.el.emit("nav-agent-move",{move:"up"}):this.el.emit("nav-agent-move",{move:"down"}))),t.position.y=n.point.y)})})},{}],5:[function(t,e,n){"use strict";e.exports=AFRAME.registerComponent("nav-mesh",{schema:{nodeName:{type:"string"}},init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.nodeName=this.data.nodeName,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){var t=this,e=this.el.getObject3D("mesh");this.el.sceneEl.object3D;if(e){var n=void 0;if(e.traverse(function(e){!e.isMesh||t.nodeName&&e.name!==t.nodeName||(n=e)}),n){var r=n.geometry.clone();n.updateWorldMatrix(!0,!1),r.applyMatrix4(n.matrixWorld),this.system.setNavMeshGeometry(r),this.hasLoadedNavMesh=!0}}}})},{}],6:[function(t,e,n){"use strict";e.exports=AFRAME.registerComponent("nav-terrian",{schema:{terrianName:{type:"string"}},init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.nodeName=this.data.nodeName,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){var t=this,e=this.el.getObject3D("mesh"),n=this.el.sceneEl.object3D;if(e){var r=void 0;e.traverse(function(e){e.isObject3D&&e.name===t.data.terrianName&&(r=e)}),r&&(n.updateMatrixWorld(),this.system.setTerrianMesh(r),this.hasLoadedNavMesh=!0)}}})},{}],7:[function(t,e,n){"use strict";var r,i,o,s,a=t("three-pathfinding").Pathfinding,h=new a,u="level";e.exports=AFRAME.registerSystem("nav",{init:function(){this.navMesh=null,this.agents=new Set,this.terrianMesh=null},setNavMeshGeometry:function(t){this.navMesh=new THREE.Mesh(t),h.setZoneData(u,a.createZone(t)),Array.from(this.agents).forEach(function(t){return t.updateNavLocation()})},getNavMesh:function(){return this.navMesh},addAgent:function(t){this.agents.add(t)},removeAgent:function(t){this.agents.delete(t)},getPath:function(t,e,n){return this.navMesh?h.findPath(t,e,u,n):null},getGroup:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.navMesh?h.getGroup(u,t,e):null},getNode:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.navMesh?h.getClosestNode(t,u,e,n):null},clampStep:function(t,e,n,r,i){return this.navMesh?r?h.clampStep(t,e,r,u,n,i):(i.copy(e),this.getNode(e,n)):(i.copy(e),null)},setTerrianMesh:function(t){this.terrianMesh=t},getTerrianMesh:function(){return this.terrianMesh},getTerrianIntersect:function(t){return this.projectPoint(t,this.terrianMesh)},getNavStart:function(t){return this.projectPoint(t,this.navMesh)},projectPoint:(r=new THREE.Vector3,i=new THREE.Vector3(0,-1,0),o=new THREE.Raycaster(r,i),s=[],function(t,e){if(e&&t){r.copy(t),r.y+=1.5,o.set(r,i),s.length=0;var n=o.intersectObject(e,!0,s);if(n&&n.length>0){var a=n[0];return s.length=0,a}}})})},{"three-pathfinding":2}]},{},[1]);